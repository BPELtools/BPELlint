<?xml version="1.0" encoding="UTF-8"?>
<process
	xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable" 
	name="Transaction-rev1-btaRAandAAandTTPv1-role-2"
		    
	xmlns:tns="http://lspi.wiai.uniba.de/prototype/bpel/collaboration/SimpleUseCase/role-2/transaction/rev1-btaRAandAAandTTPv1/1-0" 
	targetNamespace="http://lspi.wiai.uniba.de/prototype/bpel/collaboration/SimpleUseCase/role-2/transaction/rev1-btaRAandAAandTTPv1/1-0"
	
	xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
	
	xmlns:header="http://lspi.wiai.uniba.de/prototype/xsd/header/1-0"
	xmlns:businessDocumentEnvelopes="http://lspi.wiai.uniba.de/prototype/xsd/businessDocumentEnvelopes/1-0"
	xmlns:signals="http://docs.oasis-open.org/ebxml-bp/ebbp-signals-2.0"
	xmlns:event="http://lspi.wiai.uniba.de/prototype/xsd/event/1-0"
	xmlns:transactionControlMessages="http://lspi.wiai.uniba.de/prototype/xsd/transaction/controlMessages/1-0"
	xmlns:timer="http://lspi.wiai.uniba.de/prototype/xsd/service/TimerMessages/1-0"
	>

	<import namespace="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/requestor/1-0" location="wsdl/PartnerRequestor.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/timer/client/1-0" location="wsdl/TimerClient.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/rac/callback/1-0" location="wsdl/RACCallback.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" location="wsdl/Monitoring.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/wsdl/correlation/1-0" location="wsdl/Correlation.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/timer/callback/1-0" location="wsdl/TimerCallback.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/callback/1-0" location="wsdl/BackendCallback.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/master/client/1-0" location="wsdl/MasterClient.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/rac/client/1-0" location="wsdl/RACClient.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/master/callback/1-0" location="wsdl/MasterCallback.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" location="wsdl/PartnerResponder.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" location="wsdl/BackendClient.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/xsd/event/1-0" location="wsdl/xsd/Event.xsd" importType="http://www.w3.org/2001/XMLSchema"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/xsd/transaction/controlMessages/1-0" location="wsdl/xsd/TransactionControlMessages.xsd" importType="http://www.w3.org/2001/XMLSchema"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/xsd/businessDocumentEnvelopes/1-0" location="wsdl/xsd/BusinessDocumentEnvelopes.xsd" importType="http://www.w3.org/2001/XMLSchema"/>
	<import namespace="http://docs.oasis-open.org/ebxml-bp/ebbp-signals-2.0" location="wsdl/xsd/ebbp-signals-2.0.4.xsd" importType="http://www.w3.org/2001/XMLSchema"/>
	<import namespace="http://www.w3.org/2000/09/xmldsig#" location="wsdl/xsd/xmldsig-core-schema.xsd" importType="http://www.w3.org/2001/XMLSchema"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/xsd/service/TimerMessages/1-0" location="wsdl/xsd/ServiceTimerMessages.xsd" importType="http://www.w3.org/2001/XMLSchema"/>
	<import namespace="http://www.w3.org/1999/xlink" location="wsdl/xsd/XLink.xsd" importType="http://www.w3.org/2001/XMLSchema"/>
	<import namespace="http://lspi.wiai.uniba.de/prototype/xsd/header/1-0" location="wsdl/xsd/Header.xsd" importType="http://www.w3.org/2001/XMLSchema"/>
	
	<partnerLinks> 
		<partnerLink name="ToMaster" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/master/callback/1-0" partnerLinkType="tns:MasterCallback" partnerRole="MasterCallbackPortTypeRole"/>
		<partnerLink name="ToPartner" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" partnerLinkType="tns:PartnerResponder" partnerRole="PartnerResponderPortTypeRole"/>
		<partnerLink name="FromMaster" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/master/client/1-0" partnerLinkType="tns:MasterClient" myRole="MasterClientPortTypeRole"/>
		<partnerLink name="ToBackend" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/callback/1-0" partnerLinkType="tns:BackendCallback" partnerRole="BackendCallbackPortTypeRole"/>
		<partnerLink name="FromBackend" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" partnerLinkType="tns:BackendClient" myRole="BackendClientPortTypeRole"/>
		<partnerLink name="FromPartner" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" partnerLinkType="tns:PartnerResponder" myRole="PartnerResponderPortTypeRole"/>
		<partnerLink name="ToRAC" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/rac/client/1-0" partnerLinkType="tns:RACClient" partnerRole="RACClientPortTypeRole"/>
		<partnerLink name="ToTimer" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/timer/client/1-0" partnerLinkType="tns:TimerClient" partnerRole="TimerClientPortTypeRole"/>
		<partnerLink name="FromTimer" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/timer/callback/1-0" partnerLinkType="tns:TimerCallback" myRole="TimerCallbackPortTypeRole"/>
		<partnerLink name="ToMonitoring" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" partnerLinkType="tns:Monitoring" partnerRole="MonitoringPortTypeRole"/>
		<partnerLink name="FromRAC" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/rac/callback/1-0" partnerLinkType="tns:RACCallback" myRole="RACCallbackPortTypeRole"/>
	</partnerLinks>
	
	
	<correlationSets>
	    <correlationSet name="correlationSet" properties="tns:property_CollaborationIdentifier" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/correlation/1-0"/>
	</correlationSets>	
	
	
	
	<sequence>
		<scope name="MAIN_rev1-btaRAandAAandTTPv1">
			<variables>
				<variable name="bizDoc" element="tns:BusinessDocumentEnvelope" xmlns:tns="http://lspi.wiai.uniba.de/prototype/xsd/businessDocumentEnvelopes/1-0"/>
				
				<variable name="ra" element="tns:ReceiptAcknowledgement" xmlns:tns="http://lspi.wiai.uniba.de/prototype/xsd/transaction/controlMessages/1-0"/>
				
				<variable name="rae" element="tns:ReceiptAcknowledgementException" xmlns:tns="http://lspi.wiai.uniba.de/prototype/xsd/transaction/controlMessages/1-0"/>
				
				<variable name="aa" element="tns:AcceptanceAcknowledgement" xmlns:tns="http://lspi.wiai.uniba.de/prototype/xsd/transaction/controlMessages/1-0"/>
				
				<variable name="aae" element="tns:AcceptanceAcknowledgementException" xmlns:tns="http://lspi.wiai.uniba.de/prototype/xsd/transaction/controlMessages/1-0"/>
				
				<variable name="start" element="tns:Start" xmlns:tns="http://lspi.wiai.uniba.de/prototype/xsd/transaction/controlMessages/1-0"/>
				
				<variable name="exception_to_partner" element="tns:Exception" xmlns:tns="http://docs.oasis-open.org/ebxml-bp/ebbp-signals-2.0"/>
				
				<variable name="exception_to_backend" element="tns:Exception" xmlns:tns="http://docs.oasis-open.org/ebxml-bp/ebbp-signals-2.0"/>
				
				<variable name="protocol_result" type="tns:ProtocolResultType" xmlns:tns="http://lspi.wiai.uniba.de/prototype/xsd/transaction/controlMessages/1-0"/>
				<variable name="event_counter" type="tns:int" xmlns:tns="http://www.w3.org/2001/XMLSchema"/>
			</variables>	
			<sequence>
				<scope name="START_rev1-btaRAandAAandTTPv1-INIT-Start">
					<variables>
						<variable name="startFromMaster" messageType="tns:StartMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/master/client/1-0"/>
					</variables>	
					<sequence>
						<receive name="startFromMaster_rev1-btaRAandAAandTTPv1-INIT-Start" 
								 createInstance="yes" 
								 partnerLink="FromMaster" 
						    	 operation="StartOperation" 
						    	 portType="tns:MasterClientPortType" 
						    	 xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/master/client/1-0" 
								 variable="startFromMaster" 
						>
							
							<correlations>
								<correlation set="correlationSet" initiate="yes"/>
							</correlations>
						</receive>
						<assign name="After_startFromMaster_COPIES">
							
							<copy>
								<from variable="startFromMaster" part="StartPart" />
								
								<to variable="start" />	
								
							</copy>
						</assign>
						<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-INIT-Start_1">
							<variables>
								<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
							</variables>	
							<faultHandlers>
								<catchAll>
									<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-INIT-Start_1" />
								</catchAll></faultHandlers>
							<sequence>
								<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-INIT-Start_1">
									
									<copy>
										<from>1</from>
										<to variable="event_counter" />	
										
									</copy>
									<copy>
										<from variable="event_counter" />	
										
										<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
										
									</copy>
									<copy>
										<from>xp20:current-dateTime()</from>
										<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
										
									</copy>
									<copy>
										<from>$start/header:TransactionHeader</from>
										
										<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
										
									</copy>
									<copy>
										<from>'Collaboration?start'</from>
										<to>$eventToMonitoring.EventPart/event:Content</to>
										
									</copy>
									<copy>
										<from variable="startFromMaster" part="StartPart" />
										
										<to>$eventToMonitoring.EventPart/event:Payload</to>
										
									</copy>
								</assign>
								<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-INIT-Start_1" 
								        partnerLink="ToMonitoring" 
								        operation="EventOperation" 
								        portType="tns:MonitoringPortType" 
								        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
								        inputVariable="eventToMonitoring" 
								>
								        
								</invoke>  
							</sequence>
						 	
						</scope>
					</sequence>
				 	
				</scope>
				<scope name="AUTOMATON_rev1-btaRAandAAandTTPv1">
					<variables>
						<variable name="state" type="tns:string" xmlns:tns="http://www.w3.org/2001/XMLSchema"/>
						<variable name="isFinished" type="tns:boolean" xmlns:tns="http://www.w3.org/2001/XMLSchema"/>
						<variable name="delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA" type="tns:duration" xmlns:tns="http://www.w3.org/2001/XMLSchema"/>
						<variable name="delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA" type="tns:duration" xmlns:tns="http://www.w3.org/2001/XMLSchema"/>
						<variable name="delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA" type="tns:duration" xmlns:tns="http://www.w3.org/2001/XMLSchema"/>
					</variables>	
					<sequence>
						<assign name="set_default_delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA">
							
							<copy>
								<from>
									<literal>PT3S</literal>
								</from>
								
								<to variable="delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA" />	
								
							</copy>
						</assign>
						<assign name="set_default_delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA">
							
							<copy>
								<from>
									<literal>PT3S</literal>
								</from>
								
								<to variable="delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA" />	
								
							</copy>
						</assign>
						<assign name="set_default_delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA">
							
							<copy>
								<from>
									<literal>PT3S</literal>
								</from>
								
								<to variable="delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA" />	
								
							</copy>
						</assign>
						<assign name="initiate_loop_variables">
							
							<copy>
								<from>'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc'</from>
								<to variable="state" />	
								
							</copy>
							<copy>
								<from>false()</from>
								<to variable="isFinished" />	
								
							</copy>
						</assign>
						<while name="SWITCH_OVER_STATES_rev1-btaRAandAAandTTPv1">
							
							<condition>not($isFinished)</condition>
							<sequence>
								<if name="COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Transaction">
									
									<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Transaction')</condition>
									
									<scope name="SCOPE_FOR_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Transaction">
										<while name="LOOP_INSIDE_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Transaction">
											
											<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Transaction')</condition>
											<if name="COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ">
												
												<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Transaction-REQ')</condition>
												
												<scope name="SCOPE_FOR_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ">
													<variables>
														<variable name="retryCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ" type="tns:int" xmlns:tns="http://www.w3.org/2001/XMLSchema"/>
														<variable name="errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ" type="tns:int" xmlns:tns="http://www.w3.org/2001/XMLSchema"/>
													</variables>	
													<sequence>
														<assign name="Initiate_retryCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ">
															
															<copy>
																<from>3</from>
																<to variable="retryCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ" />	
																
															</copy>
														</assign>
														<assign name="Initiate_errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ">
															
															<copy>
																<from>0</from>
																<to variable="errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ" />	
																
															</copy>
														</assign>
														<while name="LOOP_INSIDE_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ">
															
															<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Transaction-REQ')</condition>
															<sequence>
																<if name="COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable">
																	
																	<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable')</condition>
																	
																	<scope name="SCOPE_FOR_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable">
																		<while name="LOOP_INSIDE_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable">
																			
																			<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable')</condition>
																			<sequence>
																				<if name="COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP">
																					
																					<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP')</condition>
																					
																					<scope name="SCOPE_FOR_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP">
																						<variables>
																							<variable name="hasTimeoutOccured_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP" type="tns:boolean" xmlns:tns="http://www.w3.org/2001/XMLSchema"/>
																						</variables>	
																						<sequence>
																							<assign name="INITIATE_variable_hasTimeoutOccured_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP">
																								
																								<copy>
																									<from>false()</from>
																									<to variable="hasTimeoutOccured_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP" />	
																									
																								</copy>
																							</assign>
																							<scope name="START_TIMEOUT_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP">
																								<variables>
																									<variable name="startToTimerRequest" messageType="tns:StartRequestMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/timer/client/1-0"/>
																									<variable name="startToTimerResponse" messageType="tns:StartResponseMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/timer/client/1-0"/>
																								</variables>	
																								<sequence>
																									<assign name="BEFORE_startToTimerRequest_with_response_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP">
																										
																										<copy>
																											<from>$start/header:TransactionHeader/header:InstanceIdentifier</from>
																											
																											<to>$startToTimerRequest.StartRequestPart/timer:Identifier</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>P3D</literal>
																											</from>
																											
																											<to>$startToTimerRequest.StartRequestPart/timer:Duration</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>BTA</literal>
																											</from>
																											
																											<to>$startToTimerRequest.StartRequestPart/timer:Type</to>
																											
																										</copy>
																									</assign>
																									<invoke name="startToTimerRequest_with_response_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP" 
																									        partnerLink="ToTimer" 
																									        operation="StartOperation" 
																									        portType="tns:TimerClientPortType" 
																									        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/timer/client/1-0" 
																									        inputVariable="startToTimerRequest" 
																									        outputVariable="startToTimerResponse">
																									        
																									</invoke>  
																									<assign name="PLACE_HOLDER_AFTER_startToTimerRequest_with_response_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP">
																										
																										<copy>
																											<from variable="startToTimerResponse" part="StartResponsePart" />
																											
																											<to variable="startToTimerResponse" part="StartResponsePart" />
																											
																										</copy>
																									</assign>
																								</sequence>
																							 	
																							</scope>
																							<while name="LOOP_INSIDE_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP">
																								
																								<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP')</condition>
																								<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc">
																									
																									<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc'</condition>
																									
																									<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc">
																										<variables>
																											<variable name="BizDocFromPartner" messageType="tns:BusinessDocumentMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																											<variable name="cancelFromBackend" messageType="tns:CancelMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																											<variable name="GEFromPartner" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																											<variable name="OnTimeoutBTAFromTimer_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc" messageType="tns:OnTimeoutBTAMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/timer/callback/1-0"/>
																										</variables>	
																										<pick name="SELECT_TRANSITION_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc">	
																											<onMessage 
																														partnerLink="FromPartner" 
																											        	operation="BusinessDocumentOperation" 
																											        	portType="tns:PartnerResponderPortType" 
																											        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																											        	variable="BizDocFromPartner">
																											        
																											    
																												
																												<correlations>
																													<correlation set="correlationSet" initiate="no"/>
																												</correlations>	
																												
																												<sequence>
																													<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_1">
																														<variables>
																															<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																														</variables>	
																														<faultHandlers>
																															<catchAll>
																																<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_1" />
																															</catchAll></faultHandlers>
																														<sequence>
																															<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_1">
																																
																																<copy>
																																	<from>$event_counter + 1</from>
																																	<to variable="event_counter" />	
																																	
																																</copy>
																																<copy>
																																	<from variable="event_counter" />	
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																																	
																																</copy>
																																<copy>
																																	<from>xp20:current-dateTime()</from>
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																																	
																																</copy>
																																<copy>
																																	<from>$start/header:TransactionHeader</from>
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																																	
																																</copy>
																																<copy>
																																	<from>'Partner?BizDoc'</from>
																																	<to>$eventToMonitoring.EventPart/event:Content</to>
																																	
																																</copy>
																																<copy>
																																	<from variable="BizDocFromPartner" part="BusinessDocumentPart" />
																																	
																																	<to>$eventToMonitoring.EventPart/event:Payload</to>
																																	
																																</copy>
																															</assign>
																															<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_1" 
																															        partnerLink="ToMonitoring" 
																															        operation="EventOperation" 
																															        portType="tns:MonitoringPortType" 
																															        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																															        inputVariable="eventToMonitoring" 
																															>
																															        
																															</invoke>  
																														</sequence>
																													 	
																													</scope>
																													<assign name="After_BizDocFromPartner_COPIES">
																														
																														<copy>
																															<from variable="BizDocFromPartner" part="BusinessDocumentPart" />
																															
																															<to variable="bizDoc" />	
																															
																														</copy>
																														<copy>
																															<from>$bizDoc/businessDocumentEnvelopes:Body/businessDocumentEnvelopes:OriginalDocumentDateTime</from>
																															
																															<to>$exception_to_partner/signals:OriginalMessageDateTime</to>
																															
																														</copy>
																														<copy>
																															<from>$bizDoc/businessDocumentEnvelopes:Body/businessDocumentEnvelopes:OriginalDocumentIdentifier</from>
																															
																															<to>$exception_to_partner/signals:OriginalMessageIdentifier</to>
																															
																														</copy>
																														<copy>
																															<from>$bizDoc/businessDocumentEnvelopes:Body/businessDocumentEnvelopes:OriginalDocumentDateTime</from>
																															
																															<to>$exception_to_backend/signals:OriginalMessageDateTime</to>
																															
																														</copy>
																														<copy>
																															<from>$bizDoc/businessDocumentEnvelopes:Body/businessDocumentEnvelopes:OriginalDocumentIdentifier</from>
																															
																															<to>$exception_to_backend/signals:OriginalMessageIdentifier</to>
																															
																														</copy>
																													</assign>
																													<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_1">
																														
																														<copy>
																															<from>'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc'</from>
																															<to variable="state" />	
																															
																														</copy>
																													</assign>
																												</sequence>
																											</onMessage>
																											<onMessage 
																														partnerLink="FromBackend" 
																											        	operation="CancelOperation" 
																											        	portType="tns:BackendClientPortType" 
																											        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																											        	variable="cancelFromBackend">
																											        
																											    
																												
																												<correlations>
																													<correlation set="correlationSet" initiate="no"/>
																												</correlations>	
																												
																												<sequence>
																													<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_3">
																														<variables>
																															<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																														</variables>	
																														<faultHandlers>
																															<catchAll>
																																<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_3" />
																															</catchAll></faultHandlers>
																														<sequence>
																															<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_3">
																																
																																<copy>
																																	<from>$event_counter + 1</from>
																																	<to variable="event_counter" />	
																																	
																																</copy>
																																<copy>
																																	<from variable="event_counter" />	
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																																	
																																</copy>
																																<copy>
																																	<from>xp20:current-dateTime()</from>
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																																	
																																</copy>
																																<copy>
																																	<from>$start/header:TransactionHeader</from>
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																																	
																																</copy>
																																<copy>
																																	<from>'Backend?cancel'</from>
																																	<to>$eventToMonitoring.EventPart/event:Content</to>
																																	
																																</copy>
																																<copy>
																																	<from variable="cancelFromBackend" part="CancelPart" />
																																	
																																	<to>$eventToMonitoring.EventPart/event:Payload</to>
																																	
																																</copy>
																															</assign>
																															<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_3" 
																															        partnerLink="ToMonitoring" 
																															        operation="EventOperation" 
																															        portType="tns:MonitoringPortType" 
																															        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																															        inputVariable="eventToMonitoring" 
																															>
																															        
																															</invoke>  
																														</sequence>
																													 	
																													</scope>
																													<assign name="After_cancelFromBackend_COPIES">
																														
																														<copy>
																															<from>'The business transaction has been canceled'</from>
																															<to>$exception_to_partner/signals:Reason</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>Cancelation</literal>
																															</from>
																															
																															<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>AnyProtocolFailure</literal>
																															</from>
																															
																															<to variable="protocol_result" />	
																															
																														</copy>
																														<copy>
																															<from variable="cancelFromBackend" part="CancelPart" />
																															
																															<to variable="cancelFromBackend" part="CancelPart" />
																															
																														</copy>
																													</assign>
																													<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_3">
																														
																														<copy>
																															<from>'rev1-btaRAandAAandTTPv1-abort-backend-BE-GE'</from>
																															<to variable="state" />	
																															
																														</copy>
																													</assign>
																												</sequence>
																											</onMessage>
																											<onMessage 
																														partnerLink="FromPartner" 
																											        	operation="ExceptionOperation" 
																											        	portType="tns:PartnerResponderPortType" 
																											        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																											        	variable="GEFromPartner">
																											        
																											    
																												
																												<correlations>
																													<correlation set="correlationSet" initiate="no"/>
																												</correlations>	
																												
																												<sequence>
																													<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_4">
																														<variables>
																															<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																														</variables>	
																														<faultHandlers>
																															<catchAll>
																																<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_4" />
																															</catchAll></faultHandlers>
																														<sequence>
																															<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_4">
																																
																																<copy>
																																	<from>$event_counter + 1</from>
																																	<to variable="event_counter" />	
																																	
																																</copy>
																																<copy>
																																	<from variable="event_counter" />	
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																																	
																																</copy>
																																<copy>
																																	<from>xp20:current-dateTime()</from>
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																																	
																																</copy>
																																<copy>
																																	<from>$start/header:TransactionHeader</from>
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																																	
																																</copy>
																																<copy>
																																	<from>'Partner?GE'</from>
																																	<to>$eventToMonitoring.EventPart/event:Content</to>
																																	
																																</copy>
																																<copy>
																																	<from variable="GEFromPartner" part="ExceptionPart" />
																																	
																																	<to>$eventToMonitoring.EventPart/event:Payload</to>
																																	
																																</copy>
																															</assign>
																															<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_4" 
																															        partnerLink="ToMonitoring" 
																															        operation="EventOperation" 
																															        portType="tns:MonitoringPortType" 
																															        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																															        inputVariable="eventToMonitoring" 
																															>
																															        
																															</invoke>  
																														</sequence>
																													 	
																													</scope>
																													<assign name="After_GEFromPartner_COPIES">
																														
																														<copy>
																															<from>$GEFromPartner.ExceptionPart/signals:Exception</from>
																															
																															<to variable="exception_to_backend" />	
																															
																														</copy>
																														<copy>
																															<from>'The partner detected an error'</from>
																															<to>$exception_to_backend/signals:Reason</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>PartnerError</literal>
																															</from>
																															
																															<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>AnyProtocolFailure</literal>
																															</from>
																															
																															<to variable="protocol_result" />	
																															
																														</copy>
																													</assign>
																													<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_4">
																														
																														<copy>
																															<from>'rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE'</from>
																															<to variable="state" />	
																															
																														</copy>
																													</assign>
																												</sequence>
																											</onMessage>
																											<onMessage 
																														partnerLink="FromTimer" 
																											        	operation="OnTimeoutBTAOperation" 
																											        	portType="tns:TimerCallbackPortType" 
																											        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/timer/callback/1-0" 
																											        	variable="OnTimeoutBTAFromTimer_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc">
																											        
																											    
																												
																												<correlations>
																													<correlation set="correlationSet" initiate="no"/>
																												</correlations>	
																												
																												<sequence>
																													<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_2">
																														<variables>
																															<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																														</variables>	
																														<faultHandlers>
																															<catchAll>
																																<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_2" />
																															</catchAll></faultHandlers>
																														<sequence>
																															<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_2">
																																
																																<copy>
																																	<from>$event_counter + 1</from>
																																	<to variable="event_counter" />	
																																	
																																</copy>
																																<copy>
																																	<from variable="event_counter" />	
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																																	
																																</copy>
																																<copy>
																																	<from>xp20:current-dateTime()</from>
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																																	
																																</copy>
																																<copy>
																																	<from>$start/header:TransactionHeader</from>
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																																	
																																</copy>
																																<copy>
																																	<from>'toBTA'</from>
																																	<to>$eventToMonitoring.EventPart/event:Content</to>
																																	
																																</copy>
																															</assign>
																															<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_2" 
																															        partnerLink="ToMonitoring" 
																															        operation="EventOperation" 
																															        portType="tns:MonitoringPortType" 
																															        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																															        inputVariable="eventToMonitoring" 
																															>
																															        
																															</invoke>  
																														</sequence>
																													 	
																													</scope>
																													<assign name="AFTER_TIMEOUT_BTA_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_COPIES">
																														
																														<copy>
																															<from variable="OnTimeoutBTAFromTimer_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc" part="OnTimeoutBTAPart" />
																															
																															<to variable="OnTimeoutBTAFromTimer_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc" part="OnTimeoutBTAPart" />
																															
																														</copy>
																														<copy>
																															<from>'Timeout while performing business transaction'</from>
																															<to>$exception_to_backend/signals:Reason</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>TtpError</literal>
																															</from>
																															
																															<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																															
																														</copy>
																														<copy>
																															<from>'Timeout while performing business transaction'</from>
																															<to>$exception_to_partner/signals:Reason</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>TtpError</literal>
																															</from>
																															
																															<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>AnyProtocolFailure</literal>
																															</from>
																															
																															<to variable="protocol_result" />	
																															
																														</copy>
																													</assign>
																													<assign name="HAS_OCCURED_TIMEOUT_variable_hasTimeoutOccured_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP">
																														
																														<copy>
																															<from>true()</from>
																															<to variable="hasTimeoutOccured_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP" />	
																															
																														</copy>
																													</assign>
																													<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP-AwaitBizDoc_2">
																														
																														<copy>
																															<from>'rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE'</from>
																															<to variable="state" />	
																															
																														</copy>
																													</assign>
																												</sequence>
																											</onMessage>
																											
																										</pick>
																									 	
																									</scope>
																									
																								</if>
																							</while>
																							<if name="IF_NOT_TIMEOUT_OCCURED_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP">
																								
																								<condition>not($hasTimeoutOccured_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP)</condition>
																								
																								<scope name="STOP_TIMEOUT_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP">
																									<variables>
																										<variable name="stopToTimerRequest" messageType="tns:StopRequestMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/timer/client/1-0"/>
																										<variable name="stopToTimerResponse" messageType="tns:StopResponseMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/timer/client/1-0"/>
																									</variables>	
																									<sequence>
																										<assign name="BEFORE_stopToTimerRequest_with_response_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP">
																											
																											<copy>
																												<from>$start/header:TransactionHeader/header:InstanceIdentifier</from>
																												
																												<to>$stopToTimerRequest.StopRequestPart/timer:Identifier</to>
																												
																											</copy>
																											<copy>
																												<from>
																													<literal>BTA</literal>
																												</from>
																												
																												<to>$stopToTimerRequest.StopRequestPart/timer:Type</to>
																												
																											</copy>
																										</assign>
																										<invoke name="stopToTimerRequest_with_response_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP" 
																										        partnerLink="ToTimer" 
																										        operation="StopOperation" 
																										        portType="tns:TimerClientPortType" 
																										        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/timer/client/1-0" 
																										        inputVariable="stopToTimerRequest" 
																										        outputVariable="stopToTimerResponse">
																										        
																										</invoke>  
																										<assign name="PLACE_HOLDER_AFTER_stopToTimerRequest_with_response_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-timeoutTTP">
																											
																											<copy>
																												<from variable="stopToTimerResponse" part="StopResponsePart" />
																												
																												<to variable="stopToTimerResponse" part="StopResponsePart" />
																												
																											</copy>
																										</assign>
																									</sequence>
																								 	
																								</scope>
																								
																							</if>
																						</sequence>
																					 	
																					</scope>
																					
																				</if>
																				<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc">
																					
																					<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc'</condition>
																					
																					<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc">
																						<variables>
																							<variable name="BizDocToRAC" messageType="tns:BusinessDocumentMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/rac/client/1-0"/>
																							<variable name="cancelFromBackend" messageType="tns:CancelMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																							<variable name="GEFromPartner" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																						</variables>	
																						<pick name="SELECT_TRANSITION_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc">	
																							<onMessage 
																										partnerLink="FromBackend" 
																							        	operation="CancelOperation" 
																							        	portType="tns:BackendClientPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																							        	variable="cancelFromBackend">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_2">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_2" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_2">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend?cancel'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="cancelFromBackend" part="CancelPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_2" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_cancelFromBackend_COPIES">
																										
																										<copy>
																											<from>'The business transaction has been canceled'</from>
																											<to>$exception_to_partner/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>Cancelation</literal>
																											</from>
																											
																											<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																										<copy>
																											<from variable="cancelFromBackend" part="CancelPart" />
																											
																											<to variable="cancelFromBackend" part="CancelPart" />
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_2">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-backend-BE-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromPartner" 
																							        	operation="ExceptionOperation" 
																							        	portType="tns:PartnerResponderPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																							        	variable="GEFromPartner">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_3">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_3" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_3">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Partner?GE'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="GEFromPartner" part="ExceptionPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_3" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_GEFromPartner_COPIES">
																										
																										<copy>
																											<from>$GEFromPartner.ExceptionPart/signals:Exception</from>
																											
																											<to variable="exception_to_backend" />	
																											
																										</copy>
																										<copy>
																											<from>'The partner detected an error'</from>
																											<to>$exception_to_backend/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>PartnerError</literal>
																											</from>
																											
																											<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_3">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							
																							<onAlarm>
																								<for>'PT3S'</for>
																								<sequence>
																									<assign name="Before_BizDocToRAC_COPIES">
																										
																										<copy>
																											<from>$start/header:TransactionHeader</from>
																											
																											<to>$BizDocToRAC.BusinessDocumentPart/header:TransactionHeader</to>
																											
																										</copy>
																										<copy>
																											<from variable="bizDoc" />	
																											
																											<to variable="BizDocToRAC" part="BusinessDocumentPart" />
																											
																										</copy>
																									</assign>
																									<invoke name="BizDocToRAC_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc" 
																									        partnerLink="ToRAC" 
																									        operation="BusinessDocumentOperation" 
																									        portType="tns:RACClientPortType" 
																									        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/rac/client/1-0" 
																									        inputVariable="BizDocToRAC" 
																									>
																									        
																									</invoke>  
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_1">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_1" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_1">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'ValidationService!BizDoc'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="BizDocToRAC" part="BusinessDocumentPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_1" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotBizDoc_1">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onAlarm>
																						</pick>
																					 	
																					</scope>
																					
																				</if>
																				<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation">
																					
																					<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation'</condition>
																					
																					<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation">
																						<variables>
																							<variable name="RAFromRAC" messageType="tns:ReceiptAcknowledgementMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/rac/callback/1-0"/>
																							<variable name="RAEFromRAC" messageType="tns:ReceiptAcknowledgementExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/rac/callback/1-0"/>
																							<variable name="cancelFromBackend" messageType="tns:CancelMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																							<variable name="GEFromPartner" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																						</variables>	
																						<pick name="SELECT_TRANSITION_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation">	
																							<onMessage 
																										partnerLink="FromRAC" 
																							        	operation="ReceiptAcknowledgementOperation" 
																							        	portType="tns:RACCallbackPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/rac/callback/1-0" 
																							        	variable="RAFromRAC">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_1">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_1" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_1">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'ValidationService?RA'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="RAFromRAC" part="ReceiptAcknowledgementPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_1" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_RAFromRAC_COPIES">
																										
																										<copy>
																											<from variable="RAFromRAC" part="ReceiptAcknowledgementPart" />
																											
																											<to variable="ra" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_1">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromRAC" 
																							        	operation="ReceiptAcknowledgementExceptionOperation" 
																							        	portType="tns:RACCallbackPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/rac/callback/1-0" 
																							        	variable="RAEFromRAC">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_2">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_2" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_2">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'ValidationService?RAE'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="RAEFromRAC" part="ReceiptAcknowledgementExceptionPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_2" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_RAEFromRAC_COPIES">
																										
																										<copy>
																											<from variable="RAEFromRAC" part="ReceiptAcknowledgementExceptionPart" />
																											
																											<to variable="rae" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_2">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromBackend" 
																							        	operation="CancelOperation" 
																							        	portType="tns:BackendClientPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																							        	variable="cancelFromBackend">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_3">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_3" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_3">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend?cancel'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="cancelFromBackend" part="CancelPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_3" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_cancelFromBackend_COPIES">
																										
																										<copy>
																											<from>'The business transaction has been canceled'</from>
																											<to>$exception_to_partner/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>Cancelation</literal>
																											</from>
																											
																											<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																										<copy>
																											<from variable="cancelFromBackend" part="CancelPart" />
																											
																											<to variable="cancelFromBackend" part="CancelPart" />
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_3">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-backend-BE-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromPartner" 
																							        	operation="ExceptionOperation" 
																							        	portType="tns:PartnerResponderPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																							        	variable="GEFromPartner">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_4">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_4" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_4">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Partner?GE'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="GEFromPartner" part="ExceptionPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_4" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_GEFromPartner_COPIES">
																										
																										<copy>
																											<from>$GEFromPartner.ExceptionPart/signals:Exception</from>
																											
																											<to variable="exception_to_backend" />	
																											
																										</copy>
																										<copy>
																											<from>'The partner detected an error'</from>
																											<to>$exception_to_backend/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>PartnerError</literal>
																											</from>
																											
																											<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitValidation_4">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							
																						</pick>
																					 	
																					</scope>
																					
																				</if>
																				<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA">
																					
																					<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA'</condition>
																					
																					<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA">
																						<variables>
																							<variable name="BizDocToBackend" messageType="tns:BusinessDocumentMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/callback/1-0"/>
																							<variable name="cancelFromBackend" messageType="tns:CancelMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																							<variable name="GEFromPartner" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																						</variables>	
																						<pick name="SELECT_TRANSITION_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA">	
																							<onMessage 
																										partnerLink="FromBackend" 
																							        	operation="CancelOperation" 
																							        	portType="tns:BackendClientPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																							        	variable="cancelFromBackend">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_2">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_2" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_2">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend?cancel'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="cancelFromBackend" part="CancelPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_2" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_cancelFromBackend_COPIES">
																										
																										<copy>
																											<from>'The business transaction has been canceled'</from>
																											<to>$exception_to_partner/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>Cancelation</literal>
																											</from>
																											
																											<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																										<copy>
																											<from variable="cancelFromBackend" part="CancelPart" />
																											
																											<to variable="cancelFromBackend" part="CancelPart" />
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_2">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-backend-BE-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromPartner" 
																							        	operation="ExceptionOperation" 
																							        	portType="tns:PartnerResponderPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																							        	variable="GEFromPartner">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_3">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_3" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_3">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Partner?GE'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="GEFromPartner" part="ExceptionPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_3" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_GEFromPartner_COPIES">
																										
																										<copy>
																											<from>$GEFromPartner.ExceptionPart/signals:Exception</from>
																											
																											<to variable="exception_to_backend" />	
																											
																										</copy>
																										<copy>
																											<from>'The partner detected an error'</from>
																											<to>$exception_to_backend/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>PartnerError</literal>
																											</from>
																											
																											<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_3">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							
																							<onAlarm>
																								<for>'PT3S'</for>
																								<sequence>
																									<assign name="Before_BizDocToBackend_COPIES">
																										
																										<copy>
																											<from>$start/header:TransactionHeader</from>
																											
																											<to>$BizDocToBackend.BusinessDocumentPart/header:TransactionHeader</to>
																											
																										</copy>
																										<copy>
																											<from variable="bizDoc" />	
																											
																											<to variable="BizDocToBackend" part="BusinessDocumentPart" />
																											
																										</copy>
																									</assign>
																									<invoke name="BizDocToBackend_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA" 
																									        partnerLink="ToBackend" 
																									        operation="BusinessDocumentOperation" 
																									        portType="tns:BackendCallbackPortType" 
																									        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/callback/1-0" 
																									        inputVariable="BizDocToBackend" 
																									>
																									        
																									</invoke>  
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_1">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_1" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_1">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend!BizDoc'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="BizDocToBackend" part="BusinessDocumentPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_1" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRA_1">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onAlarm>
																						</pick>
																					 	
																					</scope>
																					
																				</if>
																				<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA">
																					
																					<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA'</condition>
																					
																					<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA">
																						<variables>
																							<variable name="AAEFromBackend" messageType="tns:AcceptanceAcknowledgementExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																							<variable name="AAFromBackend" messageType="tns:AcceptanceAcknowledgementMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																							<variable name="cancelFromBackend" messageType="tns:CancelMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																							<variable name="GEFromPartner" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																						</variables>	
																						<pick name="SELECT_TRANSITION_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA">	
																							<onMessage 
																										partnerLink="FromBackend" 
																							        	operation="AcceptanceAcknowledgementExceptionOperation" 
																							        	portType="tns:BackendClientPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																							        	variable="AAEFromBackend">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_1">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_1" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_1">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend?AAE'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="AAEFromBackend" part="AcceptanceAcknowledgementExceptionPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_1" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_AAEFromBackend_COPIES">
																										
																										<copy>
																											<from variable="AAEFromBackend" part="AcceptanceAcknowledgementExceptionPart" />
																											
																											<to variable="aae" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_1">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromBackend" 
																							        	operation="AcceptanceAcknowledgementOperation" 
																							        	portType="tns:BackendClientPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																							        	variable="AAFromBackend">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_2">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_2" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_2">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend?AA'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="AAFromBackend" part="AcceptanceAcknowledgementPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_2" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_AAFromBackend_COPIES">
																										
																										<copy>
																											<from variable="AAFromBackend" part="AcceptanceAcknowledgementPart" />
																											
																											<to variable="aa" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_2">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromBackend" 
																							        	operation="CancelOperation" 
																							        	portType="tns:BackendClientPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																							        	variable="cancelFromBackend">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_3">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_3" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_3">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend?cancel'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="cancelFromBackend" part="CancelPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_3" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_cancelFromBackend_COPIES">
																										
																										<copy>
																											<from>'The business transaction has been canceled'</from>
																											<to>$exception_to_partner/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>Cancelation</literal>
																											</from>
																											
																											<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																										<copy>
																											<from variable="cancelFromBackend" part="CancelPart" />
																											
																											<to variable="cancelFromBackend" part="CancelPart" />
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_3">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-backend-BE-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromPartner" 
																							        	operation="ExceptionOperation" 
																							        	portType="tns:PartnerResponderPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																							        	variable="GEFromPartner">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_4">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_4" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_4">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Partner?GE'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="GEFromPartner" part="ExceptionPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_4" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_GEFromPartner_COPIES">
																										
																										<copy>
																											<from>$GEFromPartner.ExceptionPart/signals:Exception</from>
																											
																											<to variable="exception_to_backend" />	
																											
																										</copy>
																										<copy>
																											<from>'The partner detected an error'</from>
																											<to>$exception_to_backend/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>PartnerError</literal>
																											</from>
																											
																											<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA_4">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							
																						</pick>
																					 	
																					</scope>
																					
																				</if>
																				<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE">
																					
																					<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE'</condition>
																					
																					<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE">
																						<variables>
																							<variable name="RAEToPartner" messageType="tns:ReceiptAcknowledgementExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																							<variable name="cancelFromBackend" messageType="tns:CancelMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																							<variable name="GEFromPartner" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																						</variables>	
																						<pick name="SELECT_TRANSITION_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE">	
																							<onMessage 
																										partnerLink="FromBackend" 
																							        	operation="CancelOperation" 
																							        	portType="tns:BackendClientPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																							        	variable="cancelFromBackend">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_3">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_3" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_3">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend?cancel'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="cancelFromBackend" part="CancelPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_3" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_cancelFromBackend_COPIES">
																										
																										<copy>
																											<from>'The business transaction has been canceled'</from>
																											<to>$exception_to_partner/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>Cancelation</literal>
																											</from>
																											
																											<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																										<copy>
																											<from variable="cancelFromBackend" part="CancelPart" />
																											
																											<to variable="cancelFromBackend" part="CancelPart" />
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_3">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-backend-BE-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromPartner" 
																							        	operation="ExceptionOperation" 
																							        	portType="tns:PartnerResponderPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																							        	variable="GEFromPartner">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_4">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_4" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_4">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Partner?GE'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="GEFromPartner" part="ExceptionPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_4" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_GEFromPartner_COPIES">
																										
																										<copy>
																											<from>$GEFromPartner.ExceptionPart/signals:Exception</from>
																											
																											<to variable="exception_to_backend" />	
																											
																										</copy>
																										<copy>
																											<from>'The partner detected an error'</from>
																											<to>$exception_to_backend/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>PartnerError</literal>
																											</from>
																											
																											<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_4">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							
																							<onAlarm>
																								<for>'PT3S'</for>
																								<sequence>
																									<assign name="Before_RAEToPartner_COPIES">
																										
																										<copy>
																											<from>$start/header:TransactionHeader</from>
																											
																											<to>$RAEToPartner.ReceiptAcknowledgementExceptionPart/header:TransactionHeader</to>
																											
																										</copy>
																										<copy>
																											<from variable="rae" />	
																											
																											<to variable="RAEToPartner" part="ReceiptAcknowledgementExceptionPart" />
																											
																										</copy>
																									</assign>
																									<scope name="Fail_RAEToPartner_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_scope">
																										<faultHandlers>
																											<catch faultName="tns:systemFault" xmlns:tns="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" >
																												<sequence>
																													<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_2">
																														<variables>
																															<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																														</variables>	
																														<faultHandlers>
																															<catchAll>
																																<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_2" />
																															</catchAll></faultHandlers>
																														<sequence>
																															<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_2">
																																
																																<copy>
																																	<from>$event_counter + 1</from>
																																	<to variable="event_counter" />	
																																	
																																</copy>
																																<copy>
																																	<from variable="event_counter" />	
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																																	
																																</copy>
																																<copy>
																																	<from>xp20:current-dateTime()</from>
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																																	
																																</copy>
																																<copy>
																																	<from>$start/header:TransactionHeader</from>
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																																	
																																</copy>
																																<copy>
																																	<from>'Partner!RAE_Fail'</from>
																																	<to>$eventToMonitoring.EventPart/event:Content</to>
																																	
																																</copy>
																															</assign>
																															<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_2" 
																															        partnerLink="ToMonitoring" 
																															        operation="EventOperation" 
																															        portType="tns:MonitoringPortType" 
																															        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																															        inputVariable="eventToMonitoring" 
																															>
																															        
																															</invoke>  
																														</sequence>
																													 	
																													</scope>
																													<empty name="FAIL_PARALLEL_TO_SENDING_FROM_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_2" />
																													<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_2">
																														
																														<copy>
																															<from>'rev1-btaRAandAAandTTPv1-Failure-DeliverResult'</from>
																															<to variable="state" />	
																															
																														</copy>
																													</assign>
																												</sequence>
																											</catch>
																										</faultHandlers>
																										<sequence>
																											<invoke name="RAEToPartner_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE" 
																											        partnerLink="ToPartner" 
																											        operation="ReceiptAcknowledgementExceptionOperation" 
																											        portType="tns:PartnerResponderPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																											        inputVariable="RAEToPartner" 
																											>
																											        
																											</invoke>  
																											<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_1">
																												<variables>
																													<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																												</variables>	
																												<faultHandlers>
																													<catchAll>
																														<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_1" />
																													</catchAll></faultHandlers>
																												<sequence>
																													<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_1">
																														
																														<copy>
																															<from>$event_counter + 1</from>
																															<to variable="event_counter" />	
																															
																														</copy>
																														<copy>
																															<from variable="event_counter" />	
																															
																															<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																															
																														</copy>
																														<copy>
																															<from>xp20:current-dateTime()</from>
																															<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																															
																														</copy>
																														<copy>
																															<from>$start/header:TransactionHeader</from>
																															
																															<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																															
																														</copy>
																														<copy>
																															<from>'Partner!RAE'</from>
																															<to>$eventToMonitoring.EventPart/event:Content</to>
																															
																														</copy>
																														<copy>
																															<from variable="RAEToPartner" part="ReceiptAcknowledgementExceptionPart" />
																															
																															<to>$eventToMonitoring.EventPart/event:Payload</to>
																															
																														</copy>
																													</assign>
																													<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_1" 
																													        partnerLink="ToMonitoring" 
																													        operation="EventOperation" 
																													        portType="tns:MonitoringPortType" 
																													        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																													        inputVariable="eventToMonitoring" 
																													>
																													        
																													</invoke>  
																												</sequence>
																											 	
																											</scope>
																											<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotRAE_1">
																												
																												<copy>
																													<from>'rev1-btaRAandAAandTTPv1-Failure-DeliverResult'</from>
																													<to variable="state" />	
																													
																												</copy>
																											</assign>
																										</sequence>
																									 	
																									</scope>
																								</sequence>
																							</onAlarm>
																						</pick>
																					 	
																					</scope>
																					
																				</if>
																				<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE">
																					
																					<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE'</condition>
																					
																					<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE">
																						<variables>
																							<variable name="AAEToPartner" messageType="tns:AcceptanceAcknowledgementExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																							<variable name="cancelFromBackend" messageType="tns:CancelMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																							<variable name="GEFromPartner" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																						</variables>	
																						<pick name="SELECT_TRANSITION_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE">	
																							<onMessage 
																										partnerLink="FromBackend" 
																							        	operation="CancelOperation" 
																							        	portType="tns:BackendClientPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																							        	variable="cancelFromBackend">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_3">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_3" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_3">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend?cancel'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="cancelFromBackend" part="CancelPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_3" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_cancelFromBackend_COPIES">
																										
																										<copy>
																											<from>'The business transaction has been canceled'</from>
																											<to>$exception_to_partner/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>Cancelation</literal>
																											</from>
																											
																											<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																										<copy>
																											<from variable="cancelFromBackend" part="CancelPart" />
																											
																											<to variable="cancelFromBackend" part="CancelPart" />
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_3">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-backend-BE-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromPartner" 
																							        	operation="ExceptionOperation" 
																							        	portType="tns:PartnerResponderPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																							        	variable="GEFromPartner">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_4">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_4" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_4">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Partner?GE'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="GEFromPartner" part="ExceptionPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_4" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_GEFromPartner_COPIES">
																										
																										<copy>
																											<from>$GEFromPartner.ExceptionPart/signals:Exception</from>
																											
																											<to variable="exception_to_backend" />	
																											
																										</copy>
																										<copy>
																											<from>'The partner detected an error'</from>
																											<to>$exception_to_backend/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>PartnerError</literal>
																											</from>
																											
																											<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_4">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							
																							<onAlarm>
																								<for>'PT3S'</for>
																								<sequence>
																									<assign name="Before_AAEToPartner_COPIES">
																										
																										<copy>
																											<from>$start/header:TransactionHeader</from>
																											
																											<to>$AAEToPartner.AcceptanceAcknowledgementExceptionPart/header:TransactionHeader</to>
																											
																										</copy>
																										<copy>
																											<from variable="aae" />	
																											
																											<to variable="AAEToPartner" part="AcceptanceAcknowledgementExceptionPart" />
																											
																										</copy>
																									</assign>
																									<scope name="Fail_AAEToPartner_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_scope">
																										<faultHandlers>
																											<catch faultName="tns:systemFault" xmlns:tns="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" >
																												<sequence>
																													<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_2">
																														<variables>
																															<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																														</variables>	
																														<faultHandlers>
																															<catchAll>
																																<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_2" />
																															</catchAll></faultHandlers>
																														<sequence>
																															<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_2">
																																
																																<copy>
																																	<from>$event_counter + 1</from>
																																	<to variable="event_counter" />	
																																	
																																</copy>
																																<copy>
																																	<from variable="event_counter" />	
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																																	
																																</copy>
																																<copy>
																																	<from>xp20:current-dateTime()</from>
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																																	
																																</copy>
																																<copy>
																																	<from>$start/header:TransactionHeader</from>
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																																	
																																</copy>
																																<copy>
																																	<from>'Partner!AAE_Fail'</from>
																																	<to>$eventToMonitoring.EventPart/event:Content</to>
																																	
																																</copy>
																															</assign>
																															<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_2" 
																															        partnerLink="ToMonitoring" 
																															        operation="EventOperation" 
																															        portType="tns:MonitoringPortType" 
																															        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																															        inputVariable="eventToMonitoring" 
																															>
																															        
																															</invoke>  
																														</sequence>
																													 	
																													</scope>
																													<empty name="FAIL_PARALLEL_TO_SENDING_FROM_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_2" />
																													<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_2">
																														
																														<copy>
																															<from>'rev1-btaRAandAAandTTPv1-Failure-DeliverResult'</from>
																															<to variable="state" />	
																															
																														</copy>
																													</assign>
																												</sequence>
																											</catch>
																										</faultHandlers>
																										<sequence>
																											<invoke name="AAEToPartner_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE" 
																											        partnerLink="ToPartner" 
																											        operation="AcceptanceAcknowledgementExceptionOperation" 
																											        portType="tns:PartnerResponderPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																											        inputVariable="AAEToPartner" 
																											>
																											        
																											</invoke>  
																											<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_1">
																												<variables>
																													<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																												</variables>	
																												<faultHandlers>
																													<catchAll>
																														<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_1" />
																													</catchAll></faultHandlers>
																												<sequence>
																													<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_1">
																														
																														<copy>
																															<from>$event_counter + 1</from>
																															<to variable="event_counter" />	
																															
																														</copy>
																														<copy>
																															<from variable="event_counter" />	
																															
																															<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																															
																														</copy>
																														<copy>
																															<from>xp20:current-dateTime()</from>
																															<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																															
																														</copy>
																														<copy>
																															<from>$start/header:TransactionHeader</from>
																															
																															<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																															
																														</copy>
																														<copy>
																															<from>'Partner!AAE'</from>
																															<to>$eventToMonitoring.EventPart/event:Content</to>
																															
																														</copy>
																														<copy>
																															<from variable="AAEToPartner" part="AcceptanceAcknowledgementExceptionPart" />
																															
																															<to>$eventToMonitoring.EventPart/event:Payload</to>
																															
																														</copy>
																													</assign>
																													<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_1" 
																													        partnerLink="ToMonitoring" 
																													        operation="EventOperation" 
																													        portType="tns:MonitoringPortType" 
																													        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																													        inputVariable="eventToMonitoring" 
																													>
																													        
																													</invoke>  
																												</sequence>
																											 	
																											</scope>
																											<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE_1">
																												
																												<copy>
																													<from>'rev1-btaRAandAAandTTPv1-Failure-DeliverResult'</from>
																													<to variable="state" />	
																													
																												</copy>
																											</assign>
																										</sequence>
																									 	
																									</scope>
																								</sequence>
																							</onAlarm>
																						</pick>
																					 	
																					</scope>
																					
																				</if>
																				<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA">
																					
																					<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA'</condition>
																					
																					<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA">
																						<variables>
																							<variable name="RAToPartner" messageType="tns:ReceiptAcknowledgementMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																							<variable name="AAFromBackend" messageType="tns:AcceptanceAcknowledgementMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																							<variable name="AAEFromBackend" messageType="tns:AcceptanceAcknowledgementExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																							<variable name="cancelFromBackend" messageType="tns:CancelMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																							<variable name="GEFromPartner" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																						</variables>	
																						<pick name="SELECT_TRANSITION_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA">	
																							<onMessage 
																										partnerLink="FromBackend" 
																							        	operation="AcceptanceAcknowledgementOperation" 
																							        	portType="tns:BackendClientPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																							        	variable="AAFromBackend">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_2">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_2" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_2">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend?AA'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="AAFromBackend" part="AcceptanceAcknowledgementPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_2" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_AAFromBackend_COPIES">
																										
																										<copy>
																											<from variable="AAFromBackend" part="AcceptanceAcknowledgementPart" />
																											
																											<to variable="aa" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_2">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromBackend" 
																							        	operation="AcceptanceAcknowledgementExceptionOperation" 
																							        	portType="tns:BackendClientPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																							        	variable="AAEFromBackend">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_5">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_5" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_5">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend?AAE'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="AAEFromBackend" part="AcceptanceAcknowledgementExceptionPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_5" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_AAEFromBackend_COPIES">
																										
																										<copy>
																											<from variable="AAEFromBackend" part="AcceptanceAcknowledgementExceptionPart" />
																											
																											<to variable="aae" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_5">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-GotAAE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromBackend" 
																							        	operation="CancelOperation" 
																							        	portType="tns:BackendClientPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																							        	variable="cancelFromBackend">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_6">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_6" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_6">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend?cancel'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="cancelFromBackend" part="CancelPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_6" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_cancelFromBackend_COPIES">
																										
																										<copy>
																											<from>'The business transaction has been canceled'</from>
																											<to>$exception_to_partner/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>Cancelation</literal>
																											</from>
																											
																											<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																										<copy>
																											<from variable="cancelFromBackend" part="CancelPart" />
																											
																											<to variable="cancelFromBackend" part="CancelPart" />
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_6">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-backend-BE-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromPartner" 
																							        	operation="ExceptionOperation" 
																							        	portType="tns:PartnerResponderPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																							        	variable="GEFromPartner">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_7">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_7" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_7">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Partner?GE'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="GEFromPartner" part="ExceptionPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_7" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_GEFromPartner_COPIES">
																										
																										<copy>
																											<from>$GEFromPartner.ExceptionPart/signals:Exception</from>
																											
																											<to variable="exception_to_backend" />	
																											
																										</copy>
																										<copy>
																											<from>'The partner detected an error'</from>
																											<to>$exception_to_backend/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>PartnerError</literal>
																											</from>
																											
																											<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_7">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							
																							<onAlarm>
																								<for>'PT3S'</for>
																								<sequence>
																									<assign name="Before_RAToPartner_COPIES">
																										
																										<copy>
																											<from>$start/header:TransactionHeader</from>
																											
																											<to>$RAToPartner.ReceiptAcknowledgementPart/header:TransactionHeader</to>
																											
																										</copy>
																										<copy>
																											<from variable="ra" />	
																											
																											<to variable="RAToPartner" part="ReceiptAcknowledgementPart" />
																											
																										</copy>
																									</assign>
																									<scope name="Fail_RAToPartner_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_scope">
																										<faultHandlers>
																											<catch faultName="tns:systemFault" xmlns:tns="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" >
																												<sequence>
																													<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_3">
																														<variables>
																															<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																														</variables>	
																														<faultHandlers>
																															<catchAll>
																																<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_3" />
																															</catchAll></faultHandlers>
																														<sequence>
																															<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_3">
																																
																																<copy>
																																	<from>$event_counter + 1</from>
																																	<to variable="event_counter" />	
																																	
																																</copy>
																																<copy>
																																	<from variable="event_counter" />	
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																																	
																																</copy>
																																<copy>
																																	<from>xp20:current-dateTime()</from>
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																																	
																																</copy>
																																<copy>
																																	<from>$start/header:TransactionHeader</from>
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																																	
																																</copy>
																																<copy>
																																	<from>'Partner!RA_Fail'</from>
																																	<to>$eventToMonitoring.EventPart/event:Content</to>
																																	
																																</copy>
																															</assign>
																															<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_3" 
																															        partnerLink="ToMonitoring" 
																															        operation="EventOperation" 
																															        portType="tns:MonitoringPortType" 
																															        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																															        inputVariable="eventToMonitoring" 
																															>
																															        
																															</invoke>  
																														</sequence>
																													 	
																													</scope>
																													<assign name="AFTER_FAIL_OF_SENDING_RA_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_COPIES">
																														
																														<copy>
																															<from>'ReceiptAcknowledgement could not be delivered to partner'</from>
																															<to>$exception_to_backend/signals:Reason</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>ReceiptAcknowledgementDeliveryError</literal>
																															</from>
																															
																															<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																															
																														</copy>
																														<copy>
																															<from>'ReceiptAcknowledgement could not be delivered to requestor (that is probably you). Terminating process'</from>
																															<to>$exception_to_partner/signals:Reason</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>ReceiptAcknowledgementDeliveryError</literal>
																															</from>
																															
																															<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>AnyProtocolFailure</literal>
																															</from>
																															
																															<to variable="protocol_result" />	
																															
																														</copy>
																													</assign>
																													<if>
																														<condition>$errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ &lt; $retryCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ</condition>
																														
																														<sequence>
																															<assign name="IncrementVariable_errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ">
																																
																																<copy>
																																	<from>$errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ + 1</from>
																																	<to variable="errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ" />	
																																	
																																</copy>
																															</assign>
																															<assign name="set_new_delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA">
																																
																																<copy>
																																	<from>
																																		<literal>PT60S</literal>
																																	</from>
																																	
																																	<to variable="delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA" />	
																																	
																																</copy>
																															</assign>
																															<empty name="LOOPING_IN_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_3" />
																														</sequence>
																														
																														<else>
																														<if>
																															<condition>$errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ &gt; $retryCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ</condition>
																															
																															<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_4">
																																
																																<copy>
																																	<from>'rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE'</from>
																																	<to variable="state" />	
																																	
																																</copy>
																															</assign>
																															
																														</if>
																														</else>
																													</if>
																												</sequence>
																											</catch>
																										</faultHandlers>
																										<sequence>
																											<invoke name="RAToPartner_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA" 
																											        partnerLink="ToPartner" 
																											        operation="ReceiptAcknowledgementOperation" 
																											        portType="tns:PartnerResponderPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																											        inputVariable="RAToPartner" 
																											>
																											        
																											</invoke>  
																											<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_1">
																												<variables>
																													<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																												</variables>	
																												<faultHandlers>
																													<catchAll>
																														<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_1" />
																													</catchAll></faultHandlers>
																												<sequence>
																													<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_1">
																														
																														<copy>
																															<from>$event_counter + 1</from>
																															<to variable="event_counter" />	
																															
																														</copy>
																														<copy>
																															<from variable="event_counter" />	
																															
																															<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																															
																														</copy>
																														<copy>
																															<from>xp20:current-dateTime()</from>
																															<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																															
																														</copy>
																														<copy>
																															<from>$start/header:TransactionHeader</from>
																															
																															<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																															
																														</copy>
																														<copy>
																															<from>'Partner!RA'</from>
																															<to>$eventToMonitoring.EventPart/event:Content</to>
																															
																														</copy>
																														<copy>
																															<from variable="RAToPartner" part="ReceiptAcknowledgementPart" />
																															
																															<to>$eventToMonitoring.EventPart/event:Payload</to>
																															
																														</copy>
																													</assign>
																													<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_1" 
																													        partnerLink="ToMonitoring" 
																													        operation="EventOperation" 
																													        portType="tns:MonitoringPortType" 
																													        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																													        inputVariable="eventToMonitoring" 
																													>
																													        
																													</invoke>  
																												</sequence>
																											 	
																											</scope>
																											<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA_1">
																												
																												<copy>
																													<from>'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-AwaitAA'</from>
																													<to variable="state" />	
																													
																												</copy>
																											</assign>
																										</sequence>
																									 	
																									</scope>
																								</sequence>
																							</onAlarm>
																						</pick>
																					 	
																					</scope>
																					
																				</if>
																				<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA">
																					
																					<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA'</condition>
																					
																					<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA">
																						<variables>
																							<variable name="RAToPartner" messageType="tns:ReceiptAcknowledgementMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																							<variable name="cancelFromBackend" messageType="tns:CancelMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0"/>
																							<variable name="GEFromPartner" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																						</variables>	
																						<pick name="SELECT_TRANSITION_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA">	
																							<onMessage 
																										partnerLink="FromBackend" 
																							        	operation="CancelOperation" 
																							        	portType="tns:BackendClientPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/client/1-0" 
																							        	variable="cancelFromBackend">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_4">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_4" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_4">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Backend?cancel'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="cancelFromBackend" part="CancelPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_4" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_cancelFromBackend_COPIES">
																										
																										<copy>
																											<from>'The business transaction has been canceled'</from>
																											<to>$exception_to_partner/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>Cancelation</literal>
																											</from>
																											
																											<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																										<copy>
																											<from variable="cancelFromBackend" part="CancelPart" />
																											
																											<to variable="cancelFromBackend" part="CancelPart" />
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_4">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-backend-BE-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							<onMessage 
																										partnerLink="FromPartner" 
																							        	operation="ExceptionOperation" 
																							        	portType="tns:PartnerResponderPortType" 
																							        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																							        	variable="GEFromPartner">
																							        
																							    
																								
																								<correlations>
																									<correlation set="correlationSet" initiate="no"/>
																								</correlations>	
																								
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_5">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_5" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_5">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Partner?GE'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																												<copy>
																													<from variable="GEFromPartner" part="ExceptionPart" />
																													
																													<to>$eventToMonitoring.EventPart/event:Payload</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_5" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="After_GEFromPartner_COPIES">
																										
																										<copy>
																											<from>$GEFromPartner.ExceptionPart/signals:Exception</from>
																											
																											<to variable="exception_to_backend" />	
																											
																										</copy>
																										<copy>
																											<from>'The partner detected an error'</from>
																											<to>$exception_to_backend/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>PartnerError</literal>
																											</from>
																											
																											<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																									</assign>
																									<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_5">
																										
																										<copy>
																											<from>'rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE'</from>
																											<to variable="state" />	
																											
																										</copy>
																									</assign>
																								</sequence>
																							</onMessage>
																							
																							<onAlarm>
																								<for>'PT3S'</for>
																								<sequence>
																									<assign name="Before_RAToPartner_COPIES">
																										
																										<copy>
																											<from>$start/header:TransactionHeader</from>
																											
																											<to>$RAToPartner.ReceiptAcknowledgementPart/header:TransactionHeader</to>
																											
																										</copy>
																										<copy>
																											<from variable="ra" />	
																											
																											<to variable="RAToPartner" part="ReceiptAcknowledgementPart" />
																											
																										</copy>
																									</assign>
																									<scope name="Fail_RAToPartner_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_scope">
																										<faultHandlers>
																											<catch faultName="tns:systemFault" xmlns:tns="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" >
																												<sequence>
																													<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_2">
																														<variables>
																															<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																														</variables>	
																														<faultHandlers>
																															<catchAll>
																																<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_2" />
																															</catchAll></faultHandlers>
																														<sequence>
																															<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_2">
																																
																																<copy>
																																	<from>$event_counter + 1</from>
																																	<to variable="event_counter" />	
																																	
																																</copy>
																																<copy>
																																	<from variable="event_counter" />	
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																																	
																																</copy>
																																<copy>
																																	<from>xp20:current-dateTime()</from>
																																	<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																																	
																																</copy>
																																<copy>
																																	<from>$start/header:TransactionHeader</from>
																																	
																																	<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																																	
																																</copy>
																																<copy>
																																	<from>'Partner!RA_Fail'</from>
																																	<to>$eventToMonitoring.EventPart/event:Content</to>
																																	
																																</copy>
																															</assign>
																															<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_2" 
																															        partnerLink="ToMonitoring" 
																															        operation="EventOperation" 
																															        portType="tns:MonitoringPortType" 
																															        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																															        inputVariable="eventToMonitoring" 
																															>
																															        
																															</invoke>  
																														</sequence>
																													 	
																													</scope>
																													<assign name="AFTER_FAIL_OF_SENDING_RA_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_COPIES">
																														
																														<copy>
																															<from>'ReceiptAcknowledgement could not be delivered to partner'</from>
																															<to>$exception_to_backend/signals:Reason</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>ReceiptAcknowledgementDeliveryError</literal>
																															</from>
																															
																															<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																															
																														</copy>
																														<copy>
																															<from>'ReceiptAcknowledgement could not be delivered to requestor (that is probably you). Terminating process'</from>
																															<to>$exception_to_partner/signals:Reason</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>ReceiptAcknowledgementDeliveryError</literal>
																															</from>
																															
																															<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																															
																														</copy>
																														<copy>
																															<from>
																																<literal>AnyProtocolFailure</literal>
																															</from>
																															
																															<to variable="protocol_result" />	
																															
																														</copy>
																													</assign>
																													<if>
																														<condition>$errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ &lt; $retryCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ</condition>
																														
																														<sequence>
																															<assign name="IncrementVariable_errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ">
																																
																																<copy>
																																	<from>$errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ + 1</from>
																																	<to variable="errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ" />	
																																	
																																</copy>
																															</assign>
																															<assign name="set_new_delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA">
																																
																																<copy>
																																	<from>
																																		<literal>PT60S</literal>
																																	</from>
																																	
																																	<to variable="delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA" />	
																																	
																																</copy>
																															</assign>
																															<empty name="LOOPING_IN_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_2" />
																														</sequence>
																														
																														<else>
																														<if>
																															<condition>$errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ &gt;= $retryCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ</condition>
																															
																															<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_3">
																																
																																<copy>
																																	<from>'rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE'</from>
																																	<to variable="state" />	
																																	
																																</copy>
																															</assign>
																															
																														</if>
																														</else>
																													</if>
																												</sequence>
																											</catch>
																										</faultHandlers>
																										<sequence>
																											<invoke name="RAToPartner_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA" 
																											        partnerLink="ToPartner" 
																											        operation="ReceiptAcknowledgementOperation" 
																											        portType="tns:PartnerResponderPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																											        inputVariable="RAToPartner" 
																											>
																											        
																											</invoke>  
																											<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_1">
																												<variables>
																													<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																												</variables>	
																												<faultHandlers>
																													<catchAll>
																														<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_1" />
																													</catchAll></faultHandlers>
																												<sequence>
																													<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_1">
																														
																														<copy>
																															<from>$event_counter + 1</from>
																															<to variable="event_counter" />	
																															
																														</copy>
																														<copy>
																															<from variable="event_counter" />	
																															
																															<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																															
																														</copy>
																														<copy>
																															<from>xp20:current-dateTime()</from>
																															<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																															
																														</copy>
																														<copy>
																															<from>$start/header:TransactionHeader</from>
																															
																															<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																															
																														</copy>
																														<copy>
																															<from>'Partner!RA'</from>
																															<to>$eventToMonitoring.EventPart/event:Content</to>
																															
																														</copy>
																														<copy>
																															<from variable="RAToPartner" part="ReceiptAcknowledgementPart" />
																															
																															<to>$eventToMonitoring.EventPart/event:Payload</to>
																															
																														</copy>
																													</assign>
																													<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_1" 
																													        partnerLink="ToMonitoring" 
																													        operation="EventOperation" 
																													        portType="tns:MonitoringPortType" 
																													        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																													        inputVariable="eventToMonitoring" 
																													>
																													        
																													</invoke>  
																												</sequence>
																											 	
																											</scope>
																											<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-Cancelable-DeliverRA-AA_1">
																												
																												<copy>
																													<from>'rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA'</from>
																													<to variable="state" />	
																													
																												</copy>
																											</assign>
																										</sequence>
																									 	
																									</scope>
																								</sequence>
																							</onAlarm>
																						</pick>
																					 	
																					</scope>
																					
																				</if>
																			</sequence>
																		</while>
																	 	
																	</scope>
																	
																</if>
																<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA">
																	
																	<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA'</condition>
																	
																	<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA">
																		<variables>
																			<variable name="AAToPartner" messageType="tns:AcceptanceAcknowledgementMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																			<variable name="GEFromPartner" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																		</variables>	
																		<pick name="SELECT_TRANSITION_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA">	
																			<onMessage 
																						partnerLink="FromPartner" 
																			        	operation="ExceptionOperation" 
																			        	portType="tns:PartnerResponderPortType" 
																			        	xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																			        	variable="GEFromPartner">
																			        
																			    
																				
																				<correlations>
																					<correlation set="correlationSet" initiate="no"/>
																				</correlations>	
																				
																				<sequence>
																					<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_4">
																						<variables>
																							<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																						</variables>	
																						<faultHandlers>
																							<catchAll>
																								<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_4" />
																							</catchAll></faultHandlers>
																						<sequence>
																							<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_4">
																								
																								<copy>
																									<from>$event_counter + 1</from>
																									<to variable="event_counter" />	
																									
																								</copy>
																								<copy>
																									<from variable="event_counter" />	
																									
																									<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																									
																								</copy>
																								<copy>
																									<from>xp20:current-dateTime()</from>
																									<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																									
																								</copy>
																								<copy>
																									<from>$start/header:TransactionHeader</from>
																									
																									<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																									
																								</copy>
																								<copy>
																									<from>'Partner?GE'</from>
																									<to>$eventToMonitoring.EventPart/event:Content</to>
																									
																								</copy>
																								<copy>
																									<from variable="GEFromPartner" part="ExceptionPart" />
																									
																									<to>$eventToMonitoring.EventPart/event:Payload</to>
																									
																								</copy>
																							</assign>
																							<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_4" 
																							        partnerLink="ToMonitoring" 
																							        operation="EventOperation" 
																							        portType="tns:MonitoringPortType" 
																							        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																							        inputVariable="eventToMonitoring" 
																							>
																							        
																							</invoke>  
																						</sequence>
																					 	
																					</scope>
																					<assign name="After_GEFromPartner_COPIES">
																						
																						<copy>
																							<from>$GEFromPartner.ExceptionPart/signals:Exception</from>
																							
																							<to variable="exception_to_backend" />	
																							
																						</copy>
																						<copy>
																							<from>'The partner detected an error'</from>
																							<to>$exception_to_backend/signals:Reason</to>
																							
																						</copy>
																						<copy>
																							<from>
																								<literal>PartnerError</literal>
																							</from>
																							
																							<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																							
																						</copy>
																						<copy>
																							<from>
																								<literal>AnyProtocolFailure</literal>
																							</from>
																							
																							<to variable="protocol_result" />	
																							
																						</copy>
																					</assign>
																					<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_4">
																						
																						<copy>
																							<from>'rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE'</from>
																							<to variable="state" />	
																							
																						</copy>
																					</assign>
																				</sequence>
																			</onMessage>
																			
																			<onAlarm>
																				<for>'PT3S'</for>
																				<sequence>
																					<assign name="Before_AAToPartner_COPIES">
																						
																						<copy>
																							<from>$start/header:TransactionHeader</from>
																							
																							<to>$AAToPartner.AcceptanceAcknowledgementPart/header:TransactionHeader</to>
																							
																						</copy>
																						<copy>
																							<from variable="aa" />	
																							
																							<to variable="AAToPartner" part="AcceptanceAcknowledgementPart" />
																							
																						</copy>
																					</assign>
																					<scope name="Fail_AAToPartner_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_scope">
																						<faultHandlers>
																							<catch faultName="tns:systemFault" xmlns:tns="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" >
																								<sequence>
																									<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_2">
																										<variables>
																											<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																										</variables>	
																										<faultHandlers>
																											<catchAll>
																												<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_2" />
																											</catchAll></faultHandlers>
																										<sequence>
																											<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_2">
																												
																												<copy>
																													<from>$event_counter + 1</from>
																													<to variable="event_counter" />	
																													
																												</copy>
																												<copy>
																													<from variable="event_counter" />	
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																													
																												</copy>
																												<copy>
																													<from>xp20:current-dateTime()</from>
																													<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																													
																												</copy>
																												<copy>
																													<from>$start/header:TransactionHeader</from>
																													
																													<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																													
																												</copy>
																												<copy>
																													<from>'Partner!AA_Fail'</from>
																													<to>$eventToMonitoring.EventPart/event:Content</to>
																													
																												</copy>
																											</assign>
																											<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_2" 
																											        partnerLink="ToMonitoring" 
																											        operation="EventOperation" 
																											        portType="tns:MonitoringPortType" 
																											        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																											        inputVariable="eventToMonitoring" 
																											>
																											        
																											</invoke>  
																										</sequence>
																									 	
																									</scope>
																									<assign name="AFTER_FAIL_OF_SENDING_AA_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_COPIES">
																										
																										<copy>
																											<from>'AcceptanceAcknowledgement could not be delivered to partner'</from>
																											<to>$exception_to_backend/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AcceptanceAcknowledgementDeliveryError</literal>
																											</from>
																											
																											<to>$exception_to_backend/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>'AcceptanceAcknowledgement could not be delivered to requestor (that is probably you). Terminating process'</from>
																											<to>$exception_to_partner/signals:Reason</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AcceptanceAcknowledgementDeliveryError</literal>
																											</from>
																											
																											<to>$exception_to_partner/signals:ExceptionType/signals:GeneralException</to>
																											
																										</copy>
																										<copy>
																											<from>
																												<literal>AnyProtocolFailure</literal>
																											</from>
																											
																											<to variable="protocol_result" />	
																											
																										</copy>
																									</assign>
																									<if>
																										<condition>$errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ &lt; $retryCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ</condition>
																										
																										<sequence>
																											<assign name="IncrementVariable_errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ">
																												
																												<copy>
																													<from>$errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ + 1</from>
																													<to variable="errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ" />	
																													
																												</copy>
																											</assign>
																											<assign name="set_new_delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA">
																												
																												<copy>
																													<from>
																														<literal>PT60S</literal>
																													</from>
																													
																													<to variable="delay_for_sending_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA" />	
																													
																												</copy>
																											</assign>
																											<empty name="LOOPING_IN_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_2" />
																										</sequence>
																										
																										<else>
																										<if>
																											<condition>$errorCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ &gt;= $retryCount_in_rev1-btaRAandAAandTTPv1-Transaction-REQ</condition>
																											
																											<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_3">
																												
																												<copy>
																													<from>'rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE'</from>
																													<to variable="state" />	
																													
																												</copy>
																											</assign>
																											
																										</if>
																										</else>
																									</if>
																								</sequence>
																							</catch>
																						</faultHandlers>
																						<sequence>
																							<invoke name="AAToPartner_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA" 
																							        partnerLink="ToPartner" 
																							        operation="AcceptanceAcknowledgementOperation" 
																							        portType="tns:PartnerResponderPortType" 
																							        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																							        inputVariable="AAToPartner" 
																							>
																							        
																							</invoke>  
																							<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_1">
																								<variables>
																									<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																								</variables>	
																								<faultHandlers>
																									<catchAll>
																										<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_1" />
																									</catchAll></faultHandlers>
																								<sequence>
																									<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_1">
																										
																										<copy>
																											<from>$event_counter + 1</from>
																											<to variable="event_counter" />	
																											
																										</copy>
																										<copy>
																											<from variable="event_counter" />	
																											
																											<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																											
																										</copy>
																										<copy>
																											<from>xp20:current-dateTime()</from>
																											<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																											
																										</copy>
																										<copy>
																											<from>$start/header:TransactionHeader</from>
																											
																											<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																											
																										</copy>
																										<copy>
																											<from>'Partner!AA'</from>
																											<to>$eventToMonitoring.EventPart/event:Content</to>
																											
																										</copy>
																										<copy>
																											<from variable="AAToPartner" part="AcceptanceAcknowledgementPart" />
																											
																											<to>$eventToMonitoring.EventPart/event:Payload</to>
																											
																										</copy>
																									</assign>
																									<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_1" 
																									        partnerLink="ToMonitoring" 
																									        operation="EventOperation" 
																									        portType="tns:MonitoringPortType" 
																									        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																									        inputVariable="eventToMonitoring" 
																									>
																									        
																									</invoke>  
																								</sequence>
																							 	
																							</scope>
																							<assign name="goto_state_rev1-btaRAandAAandTTPv1-Transaction-REQ-DeliverAA_1">
																								
																								<copy>
																									<from>'rev1-btaRAandAAandTTPv1-Commit-Propagate'</from>
																									<to variable="state" />	
																									
																								</copy>
																							</assign>
																						</sequence>
																					 	
																					</scope>
																				</sequence>
																			</onAlarm>
																		</pick>
																	 	
																	</scope>
																	
																</if>
															</sequence>
														</while>
													</sequence>
												 	
												</scope>
												
											</if>
										</while>
									 	
									</scope>
									
								</if>
								<if name="COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-abort">
									
									<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-abort')</condition>
									
									<scope name="SCOPE_FOR_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-abort">
										<while name="LOOP_INSIDE_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-abort">
											
											<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-abort')</condition>
											<sequence>
												<if name="COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-abort-partner">
													
													<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-abort-partner')</condition>
													
													<scope name="SCOPE_FOR_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-abort-partner">
														<while name="LOOP_INSIDE_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-abort-partner">
															
															<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-abort-partner')</condition>
															<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE">
																
																<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE'</condition>
																
																<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE">
																	<variables>
																		<variable name="GEToBackend" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/callback/1-0"/>
																	</variables>	
																	<sequence>
																		<assign name="Before_GEToBackend_COPIES">
																			
																			<copy>
																				<from>$start/header:TransactionHeader</from>
																				
																				<to>$GEToBackend.ExceptionPart/header:TransactionHeader</to>
																				
																			</copy>
																			<copy>
																				<from variable="exception_to_backend" />	
																				
																				<to>$GEToBackend.ExceptionPart/signals:Exception</to>
																				
																			</copy>
																			<copy>
																				<from>xp20:current-dateTime()</from>
																				<to>$GEToBackend.ExceptionPart/signals:Exception/signals:ThisMessageDateTime</to>
																				
																			</copy>
																		</assign>
																		<invoke name="GEToBackend_rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE" 
																		        partnerLink="ToBackend" 
																		        operation="ExceptionOperation" 
																		        portType="tns:BackendCallbackPortType" 
																		        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/callback/1-0" 
																		        inputVariable="GEToBackend" 
																		>
																		        
																		</invoke>  
																		<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE_1">
																			<variables>
																				<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																			</variables>	
																			<faultHandlers>
																				<catchAll>
																					<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE_1" />
																				</catchAll></faultHandlers>
																			<sequence>
																				<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE_1">
																					
																					<copy>
																						<from>$event_counter + 1</from>
																						<to variable="event_counter" />	
																						
																					</copy>
																					<copy>
																						<from variable="event_counter" />	
																						
																						<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																						
																					</copy>
																					<copy>
																						<from>xp20:current-dateTime()</from>
																						<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																						
																					</copy>
																					<copy>
																						<from>$start/header:TransactionHeader</from>
																						
																						<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																						
																					</copy>
																					<copy>
																						<from>'Backend!GE'</from>
																						<to>$eventToMonitoring.EventPart/event:Content</to>
																						
																					</copy>
																					<copy>
																						<from variable="GEToBackend" part="ExceptionPart" />
																						
																						<to>$eventToMonitoring.EventPart/event:Payload</to>
																						
																					</copy>
																				</assign>
																				<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE_1" 
																				        partnerLink="ToMonitoring" 
																				        operation="EventOperation" 
																				        portType="tns:MonitoringPortType" 
																				        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																				        inputVariable="eventToMonitoring" 
																				>
																				        
																				</invoke>  
																			</sequence>
																		 	
																		</scope>
																		<assign name="goto_state_rev1-btaRAandAAandTTPv1-abort-partner-Partner-GE_1">
																			
																			<copy>
																				<from>'rev1-btaRAandAAandTTPv1-Failure-DeliverResult'</from>
																				<to variable="state" />	
																				
																			</copy>
																		</assign>
																	</sequence>
																 	
																</scope>
																
															</if>
														</while>
													 	
													</scope>
													
												</if>
												<if name="COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-abort-transaction">
													
													<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-abort-transaction')</condition>
													
													<scope name="SCOPE_FOR_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-abort-transaction">
														<while name="LOOP_INSIDE_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-abort-transaction">
															
															<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-abort-transaction')</condition>
															<sequence>
																<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE">
																	
																	<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE'</condition>
																	
																	<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE">
																		<variables>
																			<variable name="GEToBackend" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/callback/1-0"/>
																		</variables>	
																		<sequence>
																			<assign name="Before_GEToBackend_COPIES">
																				
																				<copy>
																					<from>$start/header:TransactionHeader</from>
																					
																					<to>$GEToBackend.ExceptionPart/header:TransactionHeader</to>
																					
																				</copy>
																				<copy>
																					<from variable="exception_to_backend" />	
																					
																					<to>$GEToBackend.ExceptionPart/signals:Exception</to>
																					
																				</copy>
																				<copy>
																					<from>xp20:current-dateTime()</from>
																					<to>$GEToBackend.ExceptionPart/signals:Exception/signals:ThisMessageDateTime</to>
																					
																				</copy>
																			</assign>
																			<invoke name="GEToBackend_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE" 
																			        partnerLink="ToBackend" 
																			        operation="ExceptionOperation" 
																			        portType="tns:BackendCallbackPortType" 
																			        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/callback/1-0" 
																			        inputVariable="GEToBackend" 
																			>
																			        
																			</invoke>  
																			<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE_1">
																				<variables>
																					<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																				</variables>	
																				<faultHandlers>
																					<catchAll>
																						<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE_1" />
																					</catchAll></faultHandlers>
																				<sequence>
																					<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE_1">
																						
																						<copy>
																							<from>$event_counter + 1</from>
																							<to variable="event_counter" />	
																							
																						</copy>
																						<copy>
																							<from variable="event_counter" />	
																							
																							<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																							
																						</copy>
																						<copy>
																							<from>xp20:current-dateTime()</from>
																							<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																							
																						</copy>
																						<copy>
																							<from>$start/header:TransactionHeader</from>
																							
																							<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																							
																						</copy>
																						<copy>
																							<from>'Backend!GE'</from>
																							<to>$eventToMonitoring.EventPart/event:Content</to>
																							
																						</copy>
																						<copy>
																							<from variable="GEToBackend" part="ExceptionPart" />
																							
																							<to>$eventToMonitoring.EventPart/event:Payload</to>
																							
																						</copy>
																					</assign>
																					<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE_1" 
																					        partnerLink="ToMonitoring" 
																					        operation="EventOperation" 
																					        portType="tns:MonitoringPortType" 
																					        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																					        inputVariable="eventToMonitoring" 
																					>
																					        
																					</invoke>  
																				</sequence>
																			 	
																			</scope>
																			<assign name="goto_state_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE_1">
																				
																				<copy>
																					<from>'rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2'</from>
																					<to variable="state" />	
																					
																				</copy>
																			</assign>
																		</sequence>
																	 	
																	</scope>
																	
																</if>
																<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2">
																	
																	<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2'</condition>
																	
																	<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2">
																		<variables>
																			<variable name="GEToPartner" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																		</variables>	
																		<sequence>
																			<assign name="Before_GEToPartner_COPIES">
																				
																				<copy>
																					<from>$start/header:TransactionHeader</from>
																					
																					<to>$GEToPartner.ExceptionPart/header:TransactionHeader</to>
																					
																				</copy>
																				<copy>
																					<from variable="exception_to_partner" />	
																					
																					<to>$GEToPartner.ExceptionPart/signals:Exception</to>
																					
																				</copy>
																				<copy>
																					<from>xp20:current-dateTime()</from>
																					<to>$GEToPartner.ExceptionPart/signals:Exception/signals:ThisMessageDateTime</to>
																					
																				</copy>
																			</assign>
																			<scope name="Fail_GEToPartner_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2_scope">
																				<faultHandlers>
																					<catch faultName="tns:systemFault" xmlns:tns="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" >
																						<sequence>
																							<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2_2">
																								<variables>
																									<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																								</variables>	
																								<faultHandlers>
																									<catchAll>
																										<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2_2" />
																									</catchAll></faultHandlers>
																								<sequence>
																									<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2_2">
																										
																										<copy>
																											<from>$event_counter + 1</from>
																											<to variable="event_counter" />	
																											
																										</copy>
																										<copy>
																											<from variable="event_counter" />	
																											
																											<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																											
																										</copy>
																										<copy>
																											<from>xp20:current-dateTime()</from>
																											<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																											
																										</copy>
																										<copy>
																											<from>$start/header:TransactionHeader</from>
																											
																											<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																											
																										</copy>
																										<copy>
																											<from>'Partner!GE_Fail'</from>
																											<to>$eventToMonitoring.EventPart/event:Content</to>
																											
																										</copy>
																									</assign>
																									<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2_2" 
																									        partnerLink="ToMonitoring" 
																									        operation="EventOperation" 
																									        portType="tns:MonitoringPortType" 
																									        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																									        inputVariable="eventToMonitoring" 
																									>
																									        
																									</invoke>  
																								</sequence>
																							 	
																							</scope>
																							<empty name="FAIL_PARALLEL_TO_SENDING_FROM_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2_2" />
																							<assign name="goto_state_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2_2">
																								
																								<copy>
																									<from>'rev1-btaRAandAAandTTPv1-Failure-DeliverResult'</from>
																									<to variable="state" />	
																									
																								</copy>
																							</assign>
																						</sequence>
																					</catch>
																				</faultHandlers>
																				<sequence>
																					<invoke name="GEToPartner_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2" 
																					        partnerLink="ToPartner" 
																					        operation="ExceptionOperation" 
																					        portType="tns:PartnerResponderPortType" 
																					        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																					        inputVariable="GEToPartner" 
																					>
																					        
																					</invoke>  
																					<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2_1">
																						<variables>
																							<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																						</variables>	
																						<faultHandlers>
																							<catchAll>
																								<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2_1" />
																							</catchAll></faultHandlers>
																						<sequence>
																							<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2_1">
																								
																								<copy>
																									<from>$event_counter + 1</from>
																									<to variable="event_counter" />	
																									
																								</copy>
																								<copy>
																									<from variable="event_counter" />	
																									
																									<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																									
																								</copy>
																								<copy>
																									<from>xp20:current-dateTime()</from>
																									<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																									
																								</copy>
																								<copy>
																									<from>$start/header:TransactionHeader</from>
																									
																									<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																									
																								</copy>
																								<copy>
																									<from>'Partner!GE'</from>
																									<to>$eventToMonitoring.EventPart/event:Content</to>
																									
																								</copy>
																								<copy>
																									<from variable="GEToPartner" part="ExceptionPart" />
																									
																									<to>$eventToMonitoring.EventPart/event:Payload</to>
																									
																								</copy>
																							</assign>
																							<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2_1" 
																							        partnerLink="ToMonitoring" 
																							        operation="EventOperation" 
																							        portType="tns:MonitoringPortType" 
																							        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																							        inputVariable="eventToMonitoring" 
																							>
																							        
																							</invoke>  
																						</sequence>
																					 	
																					</scope>
																					<assign name="goto_state_rev1-btaRAandAAandTTPv1-abort-transaction-CP-GE2_1">
																						
																						<copy>
																							<from>'rev1-btaRAandAAandTTPv1-Failure-DeliverResult'</from>
																							<to variable="state" />	
																							
																						</copy>
																					</assign>
																				</sequence>
																			 	
																			</scope>
																		</sequence>
																	 	
																	</scope>
																	
																</if>
															</sequence>
														</while>
													 	
													</scope>
													
												</if>
												<if name="COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-abort-backend">
													
													<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-abort-backend')</condition>
													
													<scope name="SCOPE_FOR_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-abort-backend">
														<while name="LOOP_INSIDE_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-abort-backend">
															
															<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-abort-backend')</condition>
															<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE">
																
																<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-abort-backend-BE-GE'</condition>
																
																<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE">
																	<variables>
																		<variable name="GEToPartner" messageType="tns:ExceptionMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0"/>
																	</variables>	
																	<sequence>
																		<assign name="Before_GEToPartner_COPIES">
																			
																			<copy>
																				<from>$start/header:TransactionHeader</from>
																				
																				<to>$GEToPartner.ExceptionPart/header:TransactionHeader</to>
																				
																			</copy>
																			<copy>
																				<from variable="exception_to_partner" />	
																				
																				<to>$GEToPartner.ExceptionPart/signals:Exception</to>
																				
																			</copy>
																			<copy>
																				<from>xp20:current-dateTime()</from>
																				<to>$GEToPartner.ExceptionPart/signals:Exception/signals:ThisMessageDateTime</to>
																				
																			</copy>
																		</assign>
																		<scope name="Fail_GEToPartner_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE_scope">
																			<faultHandlers>
																				<catch faultName="tns:systemFault" xmlns:tns="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" >
																					<sequence>
																						<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE_2">
																							<variables>
																								<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																							</variables>	
																							<faultHandlers>
																								<catchAll>
																									<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE_2" />
																								</catchAll></faultHandlers>
																							<sequence>
																								<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE_2">
																									
																									<copy>
																										<from>$event_counter + 1</from>
																										<to variable="event_counter" />	
																										
																									</copy>
																									<copy>
																										<from variable="event_counter" />	
																										
																										<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																										
																									</copy>
																									<copy>
																										<from>xp20:current-dateTime()</from>
																										<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																										
																									</copy>
																									<copy>
																										<from>$start/header:TransactionHeader</from>
																										
																										<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																										
																									</copy>
																									<copy>
																										<from>'Partner!GE_Fail'</from>
																										<to>$eventToMonitoring.EventPart/event:Content</to>
																										
																									</copy>
																								</assign>
																								<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE_2" 
																								        partnerLink="ToMonitoring" 
																								        operation="EventOperation" 
																								        portType="tns:MonitoringPortType" 
																								        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																								        inputVariable="eventToMonitoring" 
																								>
																								        
																								</invoke>  
																							</sequence>
																						 	
																						</scope>
																						<empty name="FAIL_PARALLEL_TO_SENDING_FROM_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE_2" />
																						<assign name="goto_state_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE_2">
																							
																							<copy>
																								<from>'rev1-btaRAandAAandTTPv1-Failure-DeliverResult'</from>
																								<to variable="state" />	
																								
																							</copy>
																						</assign>
																					</sequence>
																				</catch>
																			</faultHandlers>
																			<sequence>
																				<invoke name="GEToPartner_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE" 
																				        partnerLink="ToPartner" 
																				        operation="ExceptionOperation" 
																				        portType="tns:PartnerResponderPortType" 
																				        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/partner/responder/1-0" 
																				        inputVariable="GEToPartner" 
																				>
																				        
																				</invoke>  
																				<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE_1">
																					<variables>
																						<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																					</variables>	
																					<faultHandlers>
																						<catchAll>
																							<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE_1" />
																						</catchAll></faultHandlers>
																					<sequence>
																						<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE_1">
																							
																							<copy>
																								<from>$event_counter + 1</from>
																								<to variable="event_counter" />	
																								
																							</copy>
																							<copy>
																								<from variable="event_counter" />	
																								
																								<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																								
																							</copy>
																							<copy>
																								<from>xp20:current-dateTime()</from>
																								<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																								
																							</copy>
																							<copy>
																								<from>$start/header:TransactionHeader</from>
																								
																								<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																								
																							</copy>
																							<copy>
																								<from>'Partner!GE'</from>
																								<to>$eventToMonitoring.EventPart/event:Content</to>
																								
																							</copy>
																							<copy>
																								<from variable="GEToPartner" part="ExceptionPart" />
																								
																								<to>$eventToMonitoring.EventPart/event:Payload</to>
																								
																							</copy>
																						</assign>
																						<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE_1" 
																						        partnerLink="ToMonitoring" 
																						        operation="EventOperation" 
																						        portType="tns:MonitoringPortType" 
																						        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																						        inputVariable="eventToMonitoring" 
																						>
																						        
																						</invoke>  
																					</sequence>
																				 	
																				</scope>
																				<assign name="goto_state_rev1-btaRAandAAandTTPv1-abort-backend-BE-GE_1">
																					
																					<copy>
																						<from>'rev1-btaRAandAAandTTPv1-Failure-DeliverResult'</from>
																						<to variable="state" />	
																						
																					</copy>
																				</assign>
																			</sequence>
																		 	
																		</scope>
																	</sequence>
																 	
																</scope>
																
															</if>
														</while>
													 	
													</scope>
													
												</if>
											</sequence>
										</while>
									 	
									</scope>
									
								</if>
								<if name="COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Commit">
									
									<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Commit')</condition>
									
									<scope name="SCOPE_FOR_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Commit">
										<while name="LOOP_INSIDE_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Commit">
											
											<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Commit')</condition>
											<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Commit-Propagate">
												
												<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Commit-Propagate'</condition>
												
												<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Commit-Propagate">
													<variables>
														<variable name="persistToBackend" messageType="tns:PersistMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/callback/1-0"/>
													</variables>	
													<sequence>
														<assign name="Before_persistToBackend_COPIES">
															
															<copy>
																<from>$start/header:TransactionHeader</from>
																
																<to>$persistToBackend.PersistPart/header:TransactionHeader</to>
																
															</copy>
															<copy>
																<from>
																	<literal>ProtocolSuccess</literal>
																</from>
																
																<to variable="protocol_result" />	
																
															</copy>
														</assign>
														<invoke name="persistToBackend_rev1-btaRAandAAandTTPv1-Commit-Propagate" 
														        partnerLink="ToBackend" 
														        operation="PersistOperation" 
														        portType="tns:BackendCallbackPortType" 
														        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/backend/callback/1-0" 
														        inputVariable="persistToBackend" 
														>
														        
														</invoke>  
														<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Commit-Propagate_1">
															<variables>
																<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
															</variables>	
															<faultHandlers>
																<catchAll>
																	<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Commit-Propagate_1" />
																</catchAll></faultHandlers>
															<sequence>
																<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Commit-Propagate_1">
																	
																	<copy>
																		<from>$event_counter + 1</from>
																		<to variable="event_counter" />	
																		
																	</copy>
																	<copy>
																		<from variable="event_counter" />	
																		
																		<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																		
																	</copy>
																	<copy>
																		<from>xp20:current-dateTime()</from>
																		<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																		
																	</copy>
																	<copy>
																		<from>$start/header:TransactionHeader</from>
																		
																		<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																		
																	</copy>
																	<copy>
																		<from>'Backend!persist'</from>
																		<to>$eventToMonitoring.EventPart/event:Content</to>
																		
																	</copy>
																	<copy>
																		<from variable="persistToBackend" part="PersistPart" />
																		
																		<to>$eventToMonitoring.EventPart/event:Payload</to>
																		
																	</copy>
																</assign>
																<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Commit-Propagate_1" 
																        partnerLink="ToMonitoring" 
																        operation="EventOperation" 
																        portType="tns:MonitoringPortType" 
																        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																        inputVariable="eventToMonitoring" 
																>
																        
																</invoke>  
															</sequence>
														 	
														</scope>
														<assign name="goto_state_rev1-btaRAandAAandTTPv1-Commit-Propagate_1">
															
															<copy>
																<from>'rev1-btaRAandAAandTTPv1-Success-DeliverResult'</from>
																<to variable="state" />	
																
															</copy>
														</assign>
													</sequence>
												 	
												</scope>
												
											</if>
										</while>
									 	
									</scope>
									
								</if>
								<if name="COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Success">
									
									<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Success')</condition>
									
									<scope name="SCOPE_FOR_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Success">
										<while name="LOOP_INSIDE_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Success">
											
											<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Success')</condition>
											<sequence>
												<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Success-DeliverResult">
													
													<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Success-DeliverResult'</condition>
													
													<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Success-DeliverResult">
														<variables>
															<variable name="resultToMaster" messageType="tns:ResultMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/master/callback/1-0"/>
														</variables>	
														<sequence>
															<if>
																<condition>$protocol_result = 'ProtocolSuccess'</condition>
																
																<assign>
																	<copy>
																		<from>$bizDoc/businessDocumentEnvelopes:Body</from>
																		
																		<to>$resultToMaster.ResultPart/transactionControlMessages:Body</to>
																		
																	</copy>
																</assign>
																
															</if>
															<assign name="Before_resultToMaster_COPIES">
																
																<copy>
																	<from>$start/header:TransactionHeader</from>
																	
																	<to>$resultToMaster.ResultPart/header:TransactionHeader</to>
																	
																</copy>
																<copy>
																	<from variable="protocol_result" />	
																	
																	<to>$resultToMaster.ResultPart/transactionControlMessages:ProtocolResult</to>
																	
																</copy>
															</assign>
															<invoke name="resultToMaster_rev1-btaRAandAAandTTPv1-Success-DeliverResult" 
															        partnerLink="ToMaster" 
															        operation="ResultOperation" 
															        portType="tns:MasterCallbackPortType" 
															        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/master/callback/1-0" 
															        inputVariable="resultToMaster" 
															>
															        
															</invoke>  
															<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Success-DeliverResult_1">
																<variables>
																	<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																</variables>	
																<faultHandlers>
																	<catchAll>
																		<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Success-DeliverResult_1" />
																	</catchAll></faultHandlers>
																<sequence>
																	<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Success-DeliverResult_1">
																		
																		<copy>
																			<from>$event_counter + 1</from>
																			<to variable="event_counter" />	
																			
																		</copy>
																		<copy>
																			<from variable="event_counter" />	
																			
																			<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																			
																		</copy>
																		<copy>
																			<from>xp20:current-dateTime()</from>
																			<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																			
																		</copy>
																		<copy>
																			<from>$start/header:TransactionHeader</from>
																			
																			<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																			
																		</copy>
																		<copy>
																			<from>'Collaboration!result'</from>
																			<to>$eventToMonitoring.EventPart/event:Content</to>
																			
																		</copy>
																		<copy>
																			<from variable="resultToMaster" part="ResultPart" />
																			
																			<to>$eventToMonitoring.EventPart/event:Payload</to>
																			
																		</copy>
																	</assign>
																	<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Success-DeliverResult_1" 
																	        partnerLink="ToMonitoring" 
																	        operation="EventOperation" 
																	        portType="tns:MonitoringPortType" 
																	        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																	        inputVariable="eventToMonitoring" 
																	>
																	        
																	</invoke>  
																</sequence>
															 	
															</scope>
															<assign name="goto_state_rev1-btaRAandAAandTTPv1-Success-DeliverResult_1">
																
																<copy>
																	<from>'rev1-btaRAandAAandTTPv1-Success-Success'</from>
																	<to variable="state" />	
																	
																</copy>
															</assign>
														</sequence>
													 	
													</scope>
													
												</if>
												<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Success-Success">
													
													<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Success-Success'</condition>
													
													<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Success-Success">
														<assign name="EXIT_LOOP_in_rev1-btaRAandAAandTTPv1-Success-Success">
															
															<copy>
																<from>true()</from>
																<to variable="isFinished" />	
																
															</copy>
														</assign>
													 	
													</scope>
													
												</if>
											</sequence>
										</while>
									 	
									</scope>
									
								</if>
								<if name="COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Failure">
									
									<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Failure')</condition>
									
									<scope name="SCOPE_FOR_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Failure">
										<while name="LOOP_INSIDE_COMPOSITE_STATE_rev1-btaRAandAAandTTPv1-Failure">
											
											<condition>not($isFinished) and starts-with($state,'rev1-btaRAandAAandTTPv1-Failure')</condition>
											<sequence>
												<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Failure-DeliverResult">
													
													<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Failure-DeliverResult'</condition>
													
													<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Failure-DeliverResult">
														<variables>
															<variable name="resultToMaster" messageType="tns:ResultMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/master/callback/1-0"/>
														</variables>	
														<sequence>
															<if>
																<condition>$protocol_result = 'ProtocolSuccess'</condition>
																
																<assign>
																	<copy>
																		<from>$bizDoc/businessDocumentEnvelopes:Body</from>
																		
																		<to>$resultToMaster.ResultPart/transactionControlMessages:Body</to>
																		
																	</copy>
																</assign>
																
															</if>
															<assign name="Before_resultToMaster_COPIES">
																
																<copy>
																	<from>$start/header:TransactionHeader</from>
																	
																	<to>$resultToMaster.ResultPart/header:TransactionHeader</to>
																	
																</copy>
																<copy>
																	<from variable="protocol_result" />	
																	
																	<to>$resultToMaster.ResultPart/transactionControlMessages:ProtocolResult</to>
																	
																</copy>
															</assign>
															<invoke name="resultToMaster_rev1-btaRAandAAandTTPv1-Failure-DeliverResult" 
															        partnerLink="ToMaster" 
															        operation="ResultOperation" 
															        portType="tns:MasterCallbackPortType" 
															        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/master/callback/1-0" 
															        inputVariable="resultToMaster" 
															>
															        
															</invoke>  
															<scope name="MONITORING_in_rev1-btaRAandAAandTTPv1-Failure-DeliverResult_1">
																<variables>
																	<variable name="eventToMonitoring" messageType="tns:EventMessage" xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0"/>
																</variables>	
																<faultHandlers>
																	<catchAll>
																		<empty name="SWALLOW_ANY_ERRORS_in_rev1-btaRAandAAandTTPv1-Failure-DeliverResult_1" />
																	</catchAll></faultHandlers>
																<sequence>
																	<assign name="prepare_eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Failure-DeliverResult_1">
																		
																		<copy>
																			<from>$event_counter + 1</from>
																			<to variable="event_counter" />	
																			
																		</copy>
																		<copy>
																			<from variable="event_counter" />	
																			
																			<to>$eventToMonitoring.EventPart/event:Identifier/event:EventCounter</to>
																			
																		</copy>
																		<copy>
																			<from>xp20:current-dateTime()</from>
																			<to>$eventToMonitoring.EventPart/event:Identifier/event:Timestamp</to>
																			
																		</copy>
																		<copy>
																			<from>$start/header:TransactionHeader</from>
																			
																			<to>$eventToMonitoring.EventPart/event:Identifier/header:TransactionHeader</to>
																			
																		</copy>
																		<copy>
																			<from>'Collaboration!result'</from>
																			<to>$eventToMonitoring.EventPart/event:Content</to>
																			
																		</copy>
																		<copy>
																			<from variable="resultToMaster" part="ResultPart" />
																			
																			<to>$eventToMonitoring.EventPart/event:Payload</to>
																			
																		</copy>
																	</assign>
																	<invoke name="eventToMonitoring_invoke_in_rev1-btaRAandAAandTTPv1-Failure-DeliverResult_1" 
																	        partnerLink="ToMonitoring" 
																	        operation="EventOperation" 
																	        portType="tns:MonitoringPortType" 
																	        xmlns:tns="http://lspi.wiai.uniba.de/prototype/wsdl/collaboration/transaction/monitoring/1-0" 
																	        inputVariable="eventToMonitoring" 
																	>
																	        
																	</invoke>  
																</sequence>
															 	
															</scope>
															<assign name="goto_state_rev1-btaRAandAAandTTPv1-Failure-DeliverResult_1">
																
																<copy>
																	<from>'rev1-btaRAandAAandTTPv1-Failure-Failure'</from>
																	<to variable="state" />	
																	
																</copy>
															</assign>
														</sequence>
													 	
													</scope>
													
												</if>
												<if name="IF_FOR_STATE_rev1-btaRAandAAandTTPv1-Failure-Failure">
													
													<condition>not ($isFinished) and $state = 'rev1-btaRAandAAandTTPv1-Failure-Failure'</condition>
													
													<scope name="BODY_FOR_STATE_rev1-btaRAandAAandTTPv1-Failure-Failure">
														<assign name="EXIT_LOOP_in_rev1-btaRAandAAandTTPv1-Failure-Failure">
															
															<copy>
																<from>true()</from>
																<to variable="isFinished" />	
																
															</copy>
														</assign>
													 	
													</scope>
													
												</if>
											</sequence>
										</while>
									 	
									</scope>
									
								</if>
							</sequence>
						</while>
					</sequence>
				 	
				</scope>
			</sequence>
		 	
		</scope>
		<exit name="rev1-btaRAandAAandTTPv1_exit" />
	</sequence>
</process>
